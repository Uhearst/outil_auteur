define ("format_udehauthoring/evaluationHelper",["exports","./utils","./language/format_udehauthoring_fr","./validator/evaluationValidator"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.initEvaluations=function(){(0,d.validateEvaluationForm)();var a=window.location.search,c=new URLSearchParams(a);window.$.ajax({type:"POST",url:"../handlers/ajax_learning_objective_handler.php",data:{courseId:c.get("course_id")},success:function success(a){var b=JSON.parse(a);G=b.data},error:function error(){window.console.log("failure")}});window.$.ajax({type:"POST",url:"../handlers/ajax_module_handler.php",data:{courseId:c.get("course_id")},success:function success(a){var b=JSON.parse(a);F=b.data;F.push(new H("Aucun",0))},error:function error(){window.console.log("failure")}});var e=document.getElementById("form_container");e.addEventListener("click",function(a){var b="BUTTON"===a.target.nodeName||"I"===a.target.nodeName&&a.target.parentNode&&"BUTTON"===a.target.parentNode.nodeName;if(!b){}else{var c=null;if("I"===a.target.nodeName){c=a.target.parentNode}else{c=a.target}if(c&&c.id.includes("evaluation")&&!1===c.hidden){if(c.id.includes("remove")){var d=c.id.substring(c.id.lastIndexOf("_")+1);g(d);a.stopImmediatePropagation()}}else{}}});var h=document.querySelector("#id_add_evaluation");h.addEventListener("click",function(a){var b="BUTTON"===a.target.nodeName||"I"===a.target.nodeName&&a.target.parentNode&&"BUTTON"===a.target.parentNode.nodeName;if(!b){}else{a.stopImmediatePropagation();var c=null;if("I"===a.target.nodeName){c=a.target.parentNode}else{c=a.target}if(c&&c.id.includes("evaluation")&&!1===c.hidden){f(!0)}else{}}});var i=document.querySelectorAll("[class='col-md-9 form-inline align-items-start felement']");if(i){i.forEach(function(a){if("button"===a.dataset.fieldtype){a.removeAttribute("class");var b=a.childNodes;b.forEach(function(a){if(a.type&&"button"===a.type){a.classList.remove("btn-secondary")}})}})}var j=document.querySelectorAll("[class*='add_action_button']");if(j){j.forEach(function(a){var b=a.childNodes;b.forEach(function(a){a.removeAttribute("class")})})}r();(0,b.prepareAccordions)("row_course_evaluation_container_");z()};a.fillFormEvaluations=D;function e(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var E=0,F=[],G=[],H=function a(b,c){e(this,a);this.title=b;this.id=c};function f(a){var c=h(),d=document.getElementById("displayable-form-evaluations-container");d.insertBefore(c,document.getElementById("evaluation-add-container"));t();r();(0,b.initTinyMce)("id_evaluation_title_"+E,"superscript subscript | undo redo");(0,b.initTinyMce)("id_evaluation_description_"+E,"bold italic | numlist bullist | underline strikethrough superscript subscript | undo redo");y(E);if(a){(0,b.handleNewAccordionElement)(c)}}function g(a){var c=document.getElementById("row_course_evaluation_container_"+a);(0,b.removeTinyMce)("id_evaluation_title_"+a);(0,b.removeTinyMce)("id_evaluation_description_"+a);c.remove();u(a);t();r();s();E=E-1}function h(){E=E+1;var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div");a.setAttribute("class","row row-container mb-3");a.setAttribute("id","row_course_evaluation_container_"+E);b.setAttribute("class","col-11 accordion-container card");c.setAttribute("class","col-1 remove_evaluation_action_button");var d=i(),e=j();b.appendChild(d);b.appendChild(e);var f=q();c.appendChild(f);a.appendChild(b);a.appendChild(c);return a}function i(){var a=document.createElement("div"),b=document.createElement("a");a.setAttribute("class","accordion-header card-header");a.setAttribute("id","course_evaluation_header_"+E);b.setAttribute("data-toggle","collapse");b.setAttribute("href","#collapse_evaluation_"+E);b.setAttribute("role","button");b.setAttribute("aria-expanded","false");b.setAttribute("aria-controls","collapse_evaluation_"+E);b.setAttribute("class","collapsed");b.innerHTML="Evaluation "+(E+1);a.appendChild(b);return a}function j(){var a=document.createElement("div"),b=document.createElement("div");b.setAttribute("class","collapse");b.setAttribute("id","collapse_evaluation_"+E);b.setAttribute("data-parent","#displayable-form-evaluations-container");a.setAttribute("class","card-body accordion-content");a.setAttribute("id","course_evaluation_content_"+E);var d=k("evaluation_title",c.dictionnary.evaluationTitle),e=k("evaluation_description",c.dictionnary.evaluationDescription),f=l("evaluation_weight",c.dictionnary.evaluationWeight),g=m("evaluation_learning_objectives",c.dictionnary.associatedLearningObjective),h=n();a.appendChild(d);a.appendChild(e);a.appendChild(f);a.appendChild(g);a.appendChild(h);b.appendChild(a);return b}function k(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("label"),f=document.createElement("div");c.setAttribute("class","form-group row  fitem   tiny-editor");c.setAttribute("id","fitem_id_"+a+"_"+E);d.setAttribute("class","col-md-3 col-form-label d-flex pb-0 pr-md-0");e.setAttribute("class","d-inline word-break");e.setAttribute("for","id_"+a+"_"+E);e.innerHTML=b;f.setAttribute("class","col-md-9 align-items-start felement");f.setAttribute("data-fieldtype","editor");var g=p(a,E);f.appendChild(g);d.appendChild(e);c.appendChild(d);c.appendChild(f);return c}function l(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("label"),f=document.createElement("div"),g=document.createElement("input");c.setAttribute("class","form-group row  fitem   ");c.setAttribute("id","fitem_id_"+a+"_"+E);d.setAttribute("class","col-md-3 col-form-label d-flex pb-0 pr-md-0");e.setAttribute("class","d-inline word-break");e.setAttribute("for","id_"+a+"_"+E);e.innerHTML=b;f.setAttribute("class","col-md-9 form-inline align-items-start felement");f.setAttribute("data-fieldtype","text");g.setAttribute("type","text");g.setAttribute("class","form-control");g.setAttribute("name",a+"_"+E);g.setAttribute("id","id_"+a+"_"+E);f.appendChild(g);d.appendChild(e);c.appendChild(d);c.appendChild(f);return c}function m(a,c){var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("label");d.setAttribute("id","fitem_id_"+a+"_"+E);e.setAttribute("id","evaluation_learning_objectives_title_"+E);e.setAttribute("class","d-flex");f.setAttribute("for","evaluation_learning_objectives_title_"+E);f.setAttribute("class","d-inline word-break ml-3 eval-obj-title");f.innerHTML=c;e.appendChild(f);d.appendChild(e);C();G.forEach(function(c,e){var f=null;if(Array.isArray(c)){f=c}else{f=c.learningobjectives}f.forEach(function(c,f){var g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("input"),l=document.createElement("input"),m=document.createElement("label");h.setAttribute("class","form-group row  fitem  ");g.setAttribute("class","col-md-3");i.setAttribute("class","col-md-9 checkbox");j.setAttribute("class","form-check d-flex");l.setAttribute("type","hidden");l.setAttribute("name",a+"_"+E+"["+c.id+"]");l.setAttribute("value","0");k.setAttribute("type","checkbox");k.setAttribute("class","form-check-input ");k.setAttribute("name",a+"_"+E+"["+c.id+"]");k.setAttribute("id","id_"+a+"_"+E+"_"+c.id);k.setAttribute("value","1");m.setAttribute("for","id_"+a+"_"+E);m.innerHTML=e+1+"."+(f+1)+" - "+(0,b.removeTags)(c.learningobjective);j.appendChild(l);j.appendChild(k);j.appendChild(m);i.appendChild(j);h.appendChild(g);h.appendChild(i);d.appendChild(h)})});return d}function n(){var a=document.createElement("div"),b=document.createElement("div"),d=document.createElement("div"),e=document.createElement("label"),f=document.createElement("select");a.setAttribute("id","fitem_id_evaluation_module_"+E);a.setAttribute("class","form-group row  fitem   ");b.setAttribute("class","col-md-3 col-form-label d-flex pb-0 pr-md-0");e.setAttribute("class","d-inline word-break ");e.setAttribute("for","id_evaluation_module_"+E);e.innerHTML=c.dictionnary.associatedModule;d.setAttribute("class","col-md-9 form-inline align-items-start felement");d.setAttribute("data-fieldtype","select");f.setAttribute("class","custom-select");f.setAttribute("name","evaluation_module_"+E);f.setAttribute("id","id_evaluation_module_"+E);F.forEach(function(a){f.appendChild(o(a))});b.appendChild(e);d.appendChild(f);a.appendChild(b);a.appendChild(d);return a}function o(a){var b=document.createElement("option");b.setAttribute("value",a.id);b.innerHTML=a.title;return b}function p(a,b){var c=document.createElement("textarea");c.setAttribute("class","custom-editor");c.setAttribute("id","id_"+a+"_"+b);c.setAttribute("name",a+"_"+b);return c}function q(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("button"),d=document.createElement("i");a.setAttribute("id","fitem_id_remove_evaluation_"+E);b.setAttribute("data-fieldtype","button");c.setAttribute("class","btn ml-0");c.setAttribute("name","remove_evaluation_"+E);c.setAttribute("id","id_remove_evaluation_"+E);c.setAttribute("type","button");d.setAttribute("class","remove-button-js fa fa-minus-circle fa-2x");c.appendChild(d);b.appendChild(c);a.appendChild(b);return a}function r(){var a=document.querySelectorAll("[id^=\"id_evaluation_learning_objectives_\"]");if(1===a.length){var b=document.getElementById("id_remove_evaluation_0");b.hidden=!0}else{var c=document.querySelectorAll("[id^=\"id_remove_evaluation\"]");c.forEach(function(a){a.hidden=!1})}}function s(){var a=document.querySelectorAll("[id^=\"fitem_id_remove_evaluation_\"]");a.forEach(function(a,b){a.setAttribute("id","fitem_id_remove_evaluation_"+b);var c=a.querySelector("[type=\"button\"]");c.setAttribute("name","remove_evaluation_"+b);c.setAttribute("id","id_remove_evaluation_"+b)})}function t(){var a=document.querySelectorAll("[id^=\"row_course_evaluation_container_\"]"),b=document.getElementById("evaluation-add-container"),d=b.querySelector(".add-text");d.innerHTML=c.dictionnary.evaluation+(a.length+1)}function u(a){var b=document.querySelectorAll("[id^=\"row_course_evaluation_container_\"]");b.forEach(function(b){if(b.id.substring(b.id.lastIndexOf("_")+1)>a){var c=b.id.charAt(b.id.length-1);b.setAttribute("id","row_course_evaluation_container_"+(c-1));var d=b.querySelector(".accordion-header");d.setAttribute("id","course_evaluation_header_"+(c-1));d.firstElementChild.setAttribute("href","#collapse_evaluation_"+(c-1));d.firstElementChild.setAttribute("aria-controls","collapse_evaluation_"+(c-1));d.firstElementChild.innerHTML="Evaluation "+c;var e=b.querySelector(".collapse");e.setAttribute("id","collapse_evaluation_"+(c-1));e.firstElementChild.setAttribute("id","course_evaluation_content_"+(c-1));v(b,c,"title","superscript subscript | undo redo");v(b,c,"description","bold italic | numlist bullist | underline strikethrough superscript subscript | undo redo")}})}function v(a,c,d,e){var f=a.querySelector("[id^=\"fitem_id_evaluation_"+d+"_\"]");f.setAttribute("id","fitem_id_evaluation_"+d+"_"+(c-1));var g=f.querySelector("[for^=\"id_evaluation_"+d+"_\"]");g.setAttribute("for","id_evaluation_"+d+"_"+(c-1));(0,b.removeTinyMce)("id_evaluation_"+d+"_"+c);var h=f.querySelector("[id^=\"id_evaluation_"+d+"_\"]");h.setAttribute("id","id_evaluation_"+d+"_"+(c-1));h.setAttribute("name","evaluation_"+d+"_"+(c-1));(0,b.initTinyMce)("id_evaluation_"+d+"_"+(c-1),e)}function w(a,b){var c=document.getElementById("id_evaluation_weight_"+b);c.value=a.weight;a.learningobjectiveids.forEach(function(a){var c=document.getElementById("id_evaluation_learning_objectives_"+b+"_"+a.audehlearningobjectiveid);if(c){c.checked=!0}});var d=document.getElementById("id_evaluation_module_"+b);d.value=a.audehsectionid}function y(a){var b=document.getElementById("fitem_id_evaluation_title_0"),c=document.getElementById("fitem_id_evaluation_description_0"),d=document.getElementById("fitem_id_evaluation_weight_0"),e=document.getElementById("fitem_id_evaluation_learning_objectives_0"),f=document.getElementById("fitem_id_evaluation_module_0"),g=b.firstElementChild.children[1],h=c.firstElementChild.children[1],i=d.firstElementChild.children[1],j=e.firstElementChild.children[1],k=f.firstElementChild.children[1],l=document.getElementById("fitem_id_evaluation_title_"+a);l.firstElementChild.appendChild(g.cloneNode(!0));var m=document.getElementById("fitem_id_evaluation_description_"+a);m.firstElementChild.appendChild(h.cloneNode(!0));var n=document.getElementById("fitem_id_evaluation_weight_"+a);n.firstElementChild.appendChild(i.cloneNode(!0));var o=document.getElementById("fitem_id_evaluation_learning_objectives_"+a);o.firstElementChild.appendChild(j.cloneNode(!0));var p=document.getElementById("fitem_id_evaluation_module_"+a);p.firstElementChild.appendChild(k.cloneNode(!0))}function z(){var a=document.getElementById("fitem_id_evaluation_learning_objectives_0"),b=a.querySelectorAll(".form-group"),c=b[b.length-1].children[1].firstElementChild.getElementsByTagName("div");if(c[0]){var d=document.getElementById("evaluation_learning_objectives_title_0");d.appendChild(c[0])}}function A(a,b){var c=document.createElement("input");c.setAttribute("name","evaluation_"+b+"_id_value");c.setAttribute("value",a);c.hidden=!0;var d=document.getElementById("fitem_id_evaluation_title_"+b);d.parentNode.insertBefore(c,d)}function B(a,b,c){var d=null,e=setInterval(function(){d=document.getElementById(a);if(null!==d){if(0===b){d.innerHTML=c}else{d.value=c}clearInterval(e)}},100)}function C(){var a=setInterval(function(){if([]!==G){clearInterval(a)}},100)}function D(a,c){F=c;F.push(new H("Aucun",0));a.forEach(function(a,b){if(0===b){B("id_evaluation_title_0editable",0,a.title);B("id_evaluation_title_0",1,a.title);B("id_evaluation_description_0editable",0,a.description);B("id_evaluation_description_0",1,a.description)}else{if(null===document.getElementById("id_evaluation_title_"+b)){f(!1)}var c=document.getElementById("id_evaluation_title_"+b);c.value=a.title;var d=document.getElementById("id_evaluation_description_"+b);d.value=a.description}w(a,b);A(a.id,b)});(0,b.prepareActionButton)([{type:0,id:"evaluation_0"},{type:1,id:"evaluation"}]);r();(0,b.prepareAccordions)("row_course_evaluation_container_")}});
//# sourceMappingURL=evaluationHelper.min.js.map
