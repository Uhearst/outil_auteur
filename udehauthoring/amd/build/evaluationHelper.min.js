define ("format_udehauthoring/evaluationHelper",["exports","./utils","./language/format_udehauthoring_fr"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.initEvaluations=function(){var a=window.location.search,b=new URLSearchParams(a);window.$.ajax({type:"POST",url:"../handlers/ajax_learning_objective_handler.php",data:{courseId:b.get("course_id")},success:function success(a){var b=JSON.parse(a);B=b.data},error:function error(){window.console.log("failure")}});window.$.ajax({type:"POST",url:"../handlers/ajax_module_handler.php",data:{courseId:b.get("course_id")},success:function success(a){var b=JSON.parse(a);A=b.data;new C("Aucun",null);A.push(new C("Aucun",null))},error:function error(){window.console.log("failure")}});var c=document.getElementById("form_container");c.addEventListener("click",function(a){var b="BUTTON"===a.target.nodeName||"I"===a.target.nodeName&&a.target.parentNode&&"BUTTON"===a.target.parentNode.nodeName;if(!b){}else{var c=null;if("I"===a.target.nodeName){c=a.target.parentNode}else{c=a.target}if(c&&c.id.includes("evaluation")&&!1===c.hidden){if(c.id.includes("remove")){var d=c.id.charAt(c.id.length-1);f(d);a.stopImmediatePropagation()}}else{}}});var d=document.querySelector("#id_add_evaluation");d.addEventListener("click",function(a){var b="BUTTON"===a.target.nodeName||"I"===a.target.nodeName&&a.target.parentNode&&"BUTTON"===a.target.parentNode.nodeName;if(!b){}else{a.stopImmediatePropagation();var c=null;if("I"===a.target.nodeName){c=a.target.parentNode}else{c=a.target}if(c&&c.id.includes("evaluation")&&!1===c.hidden){e()}else{}}});var g=document.querySelectorAll("[class='col-md-9 form-inline align-items-start felement']");if(g){g.forEach(function(a){if("button"===a.dataset.fieldtype){a.removeAttribute("class");var b=a.childNodes;b.forEach(function(a){if(a.type&&"button"===a.type){a.classList.remove("btn-secondary")}})}})}var h=document.querySelectorAll("[class*='add_action_button']");if(h){h.forEach(function(a){var b=a.childNodes;b.forEach(function(a){a.removeAttribute("class")})})}q()};a.fillFormEvaluations=y;function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var z=0,A=[],B=[],C=function a(b,c){d(this,a);this.title=b;this.id=c};function e(){var a=g(),c=document.getElementById("displayable-form-evaluations-container");c.insertBefore(a,document.getElementById("evaluation-add-container"));s();q();(0,b.initTinyMce)("id_evaluation_title_"+z,"superscript subscript | undo redo");(0,b.initTinyMce)("id_evaluation_description_"+z,"bold italic | numlist bullist | underline strikethrough superscript subscript | undo redo")}function f(a){var c=document.getElementById("row_course_evaluation_container_"+a);(0,b.removeTinyMce)("id_evaluation_title_"+a);(0,b.removeTinyMce)("id_evaluation_description_"+a);c.remove();t(a);s();q();r();z=z-1}function g(){z=z+1;var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div");a.setAttribute("class","row row-container mb-3");a.setAttribute("id","row_course_evaluation_container_"+z);b.setAttribute("class","col-11 accordion-container card");c.setAttribute("class","col-1 remove_evaluation_action_button");var d=h(),e=i();b.appendChild(d);b.appendChild(e);var f=p();c.appendChild(f);a.appendChild(b);a.appendChild(c);return a}function h(){var a=document.createElement("div"),b=document.createElement("a");a.setAttribute("class","accordion-header card-header");a.setAttribute("id","course_evaluation_header_"+z);b.setAttribute("data-toggle","collapse");b.setAttribute("href","#collapse_evaluation_"+z);b.setAttribute("role","button");b.setAttribute("aria-expanded","false");b.setAttribute("aria-controls","collapse_evaluation_"+z);b.setAttribute("class","collapsed");b.innerHTML="Evaluation "+(z+1);a.appendChild(b);return a}function i(){var a=document.createElement("div"),b=document.createElement("div");b.setAttribute("class","collapse");b.setAttribute("id","collapse_evaluation_"+z);b.setAttribute("data-parent","#displayable-form-evaluations-container");a.setAttribute("class","card-body accordion-content");a.setAttribute("id","course_evaluation_content_"+z);var d=j("evaluation_title",c.dictionnary.evaluationTitle),e=j("evaluation_description",c.dictionnary.evaluationDescription),f=k("evaluation_weight",c.dictionnary.evaluationWeight),g=l("evaluation_learning_objectives",c.dictionnary.associatedLearningObjective),h=m();a.appendChild(d);a.appendChild(e);a.appendChild(f);a.appendChild(g);a.appendChild(h);b.appendChild(a);return b}function j(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("label"),f=document.createElement("div");c.setAttribute("class","form-group row  fitem   tiny-editor");c.setAttribute("id","fitem_id_"+a+"_"+z);d.setAttribute("class","col-md-3 col-form-label d-flex pb-0 pr-md-0");e.setAttribute("class","d-inline word-break");e.setAttribute("for","id_"+a+"_"+z);e.innerHTML=b;f.setAttribute("class","col-md-9 align-items-start felement");f.setAttribute("data-fieldtype","editor");var g=o(a,z);f.appendChild(g);d.appendChild(e);c.appendChild(d);c.appendChild(f);return c}function k(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("label"),f=document.createElement("div"),g=document.createElement("input");c.setAttribute("class","form-group row  fitem   ");c.setAttribute("id","fitem_id_"+a+"_"+z);d.setAttribute("class","col-md-3 col-form-label d-flex pb-0 pr-md-0");e.setAttribute("class","d-inline word-break");e.setAttribute("for","id_"+a+"_"+z);e.innerHTML=b;f.setAttribute("class","col-md-9 form-inline align-items-start felement");f.setAttribute("data-fieldtype","text");g.setAttribute("type","text");g.setAttribute("class","form-control");g.setAttribute("name",a+"_"+z);g.setAttribute("id","id_"+a+"_"+z);f.appendChild(g);d.appendChild(e);c.appendChild(d);c.appendChild(f);return c}function l(a,c){var d=document.createElement("div"),e=document.createElement("p");d.setAttribute("id","fitem_id_"+a+"_"+z);e.innerHTML=c;d.appendChild(e);B.forEach(function(c){var e=null;if(Array.isArray(c)){e=c}else{e=c.learningobjectives}e.forEach(function(c){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("input"),j=document.createElement("input"),k=document.createElement("label");f.setAttribute("class","form-group row  fitem  ");e.setAttribute("class","col-md-3");g.setAttribute("class","col-md-9 checkbox");h.setAttribute("class","form-check d-flex");j.setAttribute("type","hidden");j.setAttribute("name",a+"_"+z+"["+c.id+"]");j.setAttribute("value","0");i.setAttribute("type","checkbox");i.setAttribute("class","form-check-input ");i.setAttribute("name",a+"_"+z+"["+c.id+"]");i.setAttribute("id","id_"+a+"_"+z+"_"+c.id);i.setAttribute("value","1");k.setAttribute("for","id_"+a+"_"+z);k.innerHTML=(0,b.removeTags)(c.learningobjective);h.appendChild(j);h.appendChild(i);h.appendChild(k);g.appendChild(h);f.appendChild(e);f.appendChild(g);d.appendChild(f)})});return d}function m(){var a=document.createElement("div"),b=document.createElement("div"),d=document.createElement("div"),e=document.createElement("label"),f=document.createElement("select");a.setAttribute("id","fitem_id_evaluation_module_"+z);a.setAttribute("class","form-group row  fitem   ");b.setAttribute("class","col-md-3 col-form-label d-flex pb-0 pr-md-0");e.setAttribute("class","d-inline word-break ");e.setAttribute("for","id_evaluation_module_"+z);e.innerHTML=c.dictionnary.associatedModule;d.setAttribute("class","col-md-9 form-inline align-items-start felement");d.setAttribute("data-fieldtype","select");f.setAttribute("class","custom-select");f.setAttribute("name","evaluation_module_"+z);f.setAttribute("id","id_evaluation_module_"+z);A.forEach(function(a){f.appendChild(n(a))});b.appendChild(e);d.appendChild(f);a.appendChild(b);a.appendChild(d);return a}function n(a){var b=document.createElement("option");b.setAttribute("value",a.id);b.innerHTML=a.title;return b}function o(a,b){var c=document.createElement("textarea");c.setAttribute("class","custom-editor");c.setAttribute("id","id_"+a+"_"+b);c.setAttribute("name",a+"_"+b);return c}function p(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("button"),d=document.createElement("i");a.setAttribute("id","fitem_id_remove_evaluation_"+z);b.setAttribute("data-fieldtype","button");c.setAttribute("class","btn ml-0");c.setAttribute("name","remove_evaluation_"+z);c.setAttribute("id","id_remove_evaluation_"+z);c.setAttribute("type","button");d.setAttribute("class","remove-button-js fa fa-minus-circle fa-2x");c.appendChild(d);b.appendChild(c);a.appendChild(b);return a}function q(){var a=document.querySelectorAll("[id^=\"id_evaluation_learning_objectives_\"]");if(1===a.length){var b=document.getElementById("id_remove_evaluation_0");b.hidden=!0}else{var c=document.querySelectorAll("[id^=\"id_remove_evaluation\"]");c.forEach(function(a){a.hidden=!1})}}function r(){var a=document.querySelectorAll("[id^=\"fitem_id_remove_evaluation_\"]");a.forEach(function(a,b){a.setAttribute("id","fitem_id_remove_evaluation_"+b);var c=a.querySelector("[type=\"button\"]");c.setAttribute("name","remove_evaluation_"+b);c.setAttribute("id","id_remove_evaluation_"+b)})}function s(){var a=document.querySelectorAll("[id^=\"row_course_evaluation_container_\"]"),b=document.getElementById("evaluation-add-container"),d=b.querySelector(".add-text");d.innerHTML=c.dictionnary.evaluation+(a.length+1)}function t(a){var b=document.querySelectorAll("[id^=\"row_course_evaluation_container_\"]");b.forEach(function(b){if(b.id.charAt(b.id.length-1)>a){var c=b.id.charAt(b.id.length-1);b.setAttribute("id","row_course_evaluation_container_"+(c-1));var d=b.querySelector(".accordion-header");d.setAttribute("id","course_evaluation_header_"+(c-1));d.firstElementChild.setAttribute("href","#collapse_evaluation_"+(c-1));d.firstElementChild.setAttribute("aria-controls","collapse_evaluation_"+(c-1));d.firstElementChild.innerHTML="Evaluation "+c;var e=b.querySelector(".collapse");e.setAttribute("id","collapse_evaluation_"+(c-1));e.firstElementChild.setAttribute("id","course_evaluation_content_"+(c-1));u(b,c,"title","superscript subscript | undo redo");u(b,c,"description","bold italic | numlist bullist | underline strikethrough superscript subscript | undo redo")}})}function u(a,c,d,e){var f=a.querySelector("[id^=\"fitem_id_evaluation_"+d+"_\"]");f.setAttribute("id","fitem_id_evaluation_"+d+"_"+(c-1));var g=f.querySelector("[for^=\"id_evaluation_"+d+"_\"]");g.setAttribute("for","id_evaluation_"+d+"_"+(c-1));(0,b.removeTinyMce)("id_evaluation_"+d+"_"+c);var h=f.querySelector("[id^=\"id_evaluation_"+d+"_\"]");h.setAttribute("id","id_evaluation_"+d+"_"+(c-1));h.setAttribute("name","evaluation_"+d+"_"+(c-1));(0,b.initTinyMce)("id_evaluation_"+d+"_"+(c-1),e)}function v(a,b){var c=document.getElementById("id_evaluation_weight_"+b);c.value=a.weight;a.learningobjectiveids.forEach(function(a){var c=document.getElementById("id_evaluation_learning_objectives_"+b+"_"+a.audehlearningobjectiveid);c.checked=!0});var d=document.getElementById("id_evaluation_module_"+b);if(0==a.audehsectionid){d.value=null}else{d.value=a.audehsectionid}}function w(a,b){var c=document.createElement("input");c.setAttribute("name","evaluation_"+b+"_id_value");c.setAttribute("value",a);c.hidden=!0;var d=document.getElementById("fitem_id_evaluation_title_"+b);d.parentNode.insertBefore(c,d)}function x(a,b,c){var d=null,e=setInterval(function(){d=document.getElementById(a);if(null!==d){if(0===b){d.innerHTML=c}else{d.value=c}clearInterval(e)}},100)}function y(a,c){A=c;new C("Aucun",null);A.push(new C("Aucun",null));a.forEach(function(a,b){if(0===b){x("id_evaluation_title_0editable",0,a.title);x("id_evaluation_title_0",1,a.title);x("id_evaluation_description_0editable",0,a.description);x("id_evaluation_description_0",1,a.description)}else{if(null===document.getElementById("id_evaluation_title_"+b)){e()}var c=document.getElementById("id_evaluation_title_"+b);c.value=a.title;var d=document.getElementById("id_evaluation_description_"+b);d.value=a.description}v(a,b);w(a.id,b)});(0,b.prepareActionButton)([{type:0,id:"evaluation_0"},{type:1,id:"evaluation"}]);q()}});
//# sourceMappingURL=evaluationHelper.min.js.map
