{"version":3,"file":"evaluationValidator.min.js","sources":["../../src/validator/evaluationValidator.js"],"sourcesContent":["import {validateIsEmbed} from \"./validatorUtils\";\nimport {addNotification} from \"../notificationHelper\";\nimport {get_string as getString} from 'core/str';\n/**\n *\n */\nexport function validateEvaluationForm() {\n    document.getElementById('udeh-form').addEventListener(\"submit\", async function(e) {\n        if (window.location.href.includes('displayable-form-evaluations-container')) {\n            e.preventDefault();\n            let isValidObjectives = await validateObjectives();\n            let isValidModules = await validateModules();\n            if (isValidObjectives && isValidModules) {\n                window.$('#udeh-form').submit();\n            }\n        }\n    });\n}\n\n/**\n * @param {Integer} length\n */\nexport function validateEvaluationDataForm(length = null) {\n    document.getElementById('udeh-form').addEventListener(\"submit\", function(e) {\n        e.preventDefault();\n\n        if (length !== null) {\n            let isGood = true;\n            for (let i = 0; i < length; i++) {\n                validateIsEmbed(i);\n            }\n            if (!isGood) {\n                return;\n            }\n        } else {\n            validateIsEmbed();\n        }\n        window.$('#udeh-form').submit();\n    });\n}\n\n/**\n *\n */\nasync function validateObjectives() {\n    let isValid = true;\n    let evaluations = document.querySelectorAll('[id^=\"row_course_evaluation_container_\"]');\n\n    let notCheckedEvaluationsId = [];\n    evaluations.forEach(function(evaluation, index) {\n        let hasChecked = false;\n        let learningObjContainer = document.getElementById('fitem_id_evaluation_learning_objectives_' + index);\n        let checkboxes = learningObjContainer.querySelectorAll('[id^=\"id_evaluation_learning_objectives_\"]');\n        checkboxes.forEach(checkbox => {\n            if (checkbox.checked) {\n                hasChecked = true;\n            }\n        });\n        if (!hasChecked) {\n            notCheckedEvaluationsId.push(index);\n        }\n    });\n\n    if (notCheckedEvaluationsId.length > 0) {\n        for (const notCheckedEvaluationId of notCheckedEvaluationsId) {\n            let errorMsg = document.getElementById('error_msg_obj_' + notCheckedEvaluationId);\n            if (errorMsg === null) {\n                let span = document.createElement('span');\n                span.style.color = 'red';\n                span.id = 'error_msg_obj_' + notCheckedEvaluationId;\n                span.style.margin = '0 0 0 1rem';\n                span.innerHTML = await getString('evaluationsaveerrorobjmsg', 'format_udehauthoring');\n                document.getElementById('course_evaluation_content_' + notCheckedEvaluationId).insertBefore(\n                    span, document.getElementById('fitem_id_evaluation_learning_objectives_' + notCheckedEvaluationId));\n            }\n        }\n        isValid = false;\n    }\n    if (!isValid) {\n        addNotification(await getString('notificationerroroneobjective', 'format_udehauthoring'), 2);\n    } else {\n        let errorMsgs = document.querySelectorAll('[id^=\"error_msg_obj_\"]');\n        errorMsgs.forEach(errorMsg => {\n            errorMsg.remove();\n        });\n    }\n    return isValid;\n}\n\n/**\n *\n */\nasync function validateModules() {\n    let isValid = true;\n    let selectedValues = [];\n    let moduleContainers = document.querySelectorAll('[id^=\"fitem_id_evaluation_module_\"]');\n\n    moduleContainers.forEach(function(moduleContainer) {\n        let select = moduleContainer.querySelector('.form-check-input');\n        if (select.checked) {\n            selectedValues.push(parseInt(select.name.substring(select.name.indexOf('[') + 1, select.name.indexOf(']'))));\n        }\n    });\n    for (const selectedValue of selectedValues) {\n        const index = selectedValues.indexOf(selectedValue);\n        let results = selectedValues.filter(val => val === selectedValue);\n        if (results.length > 1 && selectedValue !== 0) {\n            let errorMsg = document.getElementById('error_msg_module_' + index);\n            if (errorMsg === null) {\n                let span = document.createElement('span');\n                span.style.color = 'red';\n                span.id = 'error_msg_module_' + index;\n                span.style.margin = '0 0 0.5rem 1rem';\n                span.innerHTML = await getString('notificationerroruniquemodule', 'format_udehauthoring');\n                document.getElementById('course_evaluation_content_' + index).insertBefore(\n                    span, document.getElementById('fitem_id_evaluation_module_' + index));\n            }\n            isValid = false;\n        }\n    }\n    if (!isValid) {\n        addNotification(await getString('notificationerroruniquemodule', 'format_udehauthoring'), 2);\n    } else {\n        let errorMsgs = document.querySelectorAll('[id^=\"error_msg_module_\"]');\n        errorMsgs.forEach(errorMsg => {\n            errorMsg.remove();\n        });\n    }\n    return isValid;\n}\n\n"],"names":["length","document","getElementById","addEventListener","e","preventDefault","isGood","i","window","$","submit","async","location","href","includes","isValidObjectives","isValid","evaluations","querySelectorAll","notCheckedEvaluationsId","forEach","evaluation","index","hasChecked","checkbox","checked","push","notCheckedEvaluationId","span","createElement","style","color","id","margin","innerHTML","insertBefore","errorMsg","remove","validateObjectives","isValidModules","selectedValues","moduleContainer","select","querySelector","parseInt","name","substring","indexOf","selectedValue","filter","val","validateModules"],"mappings":"sSAsB2CA,8DAAS,KAChDC,SAASC,eAAe,aAAaC,iBAAiB,UAAU,SAASC,MACrEA,EAAEC,iBAEa,OAAXL,OAAiB,KACbM,QAAS,MACR,IAAIC,EAAI,EAAGA,EAAIP,OAAQO,wCACRA,OAEfD,wDAMTE,OAAOC,EAAE,cAAcC,wDA9B3BT,SAASC,eAAe,aAAaC,iBAAiB,UAAUQ,eAAeP,MACvEI,OAAOI,SAASC,KAAKC,SAAS,0CAA2C,CACzEV,EAAEC,qBACEU,6CAmCRC,SAAU,EACVC,YAAchB,SAASiB,iBAAiB,4CAExCC,wBAA0B,MAC9BF,YAAYG,SAAQ,SAASC,WAAYC,WACjCC,YAAa,EACUtB,SAASC,eAAe,2CAA6CoB,OAC1DJ,iBAAiB,8CAC5CE,SAAQI,WACXA,SAASC,UACTF,YAAa,MAGhBA,YACDJ,wBAAwBO,KAAKJ,UAIjCH,wBAAwBnB,OAAS,EAAG,KAC/B,MAAM2B,0BAA0BR,wBAAyB,IAEzC,OADFlB,SAASC,eAAe,iBAAmByB,wBACnC,KACfC,KAAO3B,SAAS4B,cAAc,QAClCD,KAAKE,MAAMC,MAAQ,MACnBH,KAAKI,GAAK,iBAAmBL,uBAC7BC,KAAKE,MAAMG,OAAS,aACpBL,KAAKM,gBAAkB,mBAAU,4BAA6B,wBAC9DjC,SAASC,eAAe,6BAA+ByB,wBAAwBQ,aAC3EP,KAAM3B,SAASC,eAAe,2CAA6CyB,0BAGvFX,SAAU,KAETA,QAEE,CACaf,SAASiB,iBAAiB,0BAChCE,SAAQgB,WACdA,SAASC,8DAJS,mBAAU,gCAAiC,wBAAyB,UAOvFrB,QA5E+BsB,GAC1BC,0CAkFRvB,SAAU,EACVwB,eAAiB,GACEvC,SAASiB,iBAAiB,uCAEhCE,SAAQ,SAASqB,qBAC1BC,OAASD,gBAAgBE,cAAc,qBACvCD,OAAOjB,SACPe,eAAed,KAAKkB,SAASF,OAAOG,KAAKC,UAAUJ,OAAOG,KAAKE,QAAQ,KAAO,EAAGL,OAAOG,KAAKE,QAAQ,eAGxG,MAAMC,iBAAiBR,eAAgB,OAClClB,MAAQkB,eAAeO,QAAQC,kBACvBR,eAAeS,QAAOC,KAAOA,MAAQF,gBACvChD,OAAS,GAAuB,IAAlBgD,cAAqB,IAE1B,OADF/C,SAASC,eAAe,oBAAsBoB,OACtC,KACfM,KAAO3B,SAAS4B,cAAc,QAClCD,KAAKE,MAAMC,MAAQ,MACnBH,KAAKI,GAAK,oBAAsBV,MAChCM,KAAKE,MAAMG,OAAS,kBACpBL,KAAKM,gBAAkB,mBAAU,gCAAiC,wBAClEjC,SAASC,eAAe,6BAA+BoB,OAAOa,aAC1DP,KAAM3B,SAASC,eAAe,8BAAgCoB,QAEtEN,SAAU,MAGbA,QAEE,CACaf,SAASiB,iBAAiB,6BAChCE,SAAQgB,WACdA,SAASC,8DAJS,mBAAU,gCAAiC,wBAAyB,UAOvFrB,QArH4BmC,GACvBpC,mBAAqBwB,gBACrB/B,OAAOC,EAAE,cAAcC"}