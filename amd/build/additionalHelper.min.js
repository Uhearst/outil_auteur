define("format_udehauthoring/additionalHelper",["exports","./validator/addtionnalInformationValidator","core/str","./utils","./accordionHandler"],(function(_exports,_addtionnalInformationValidator,_str,_utils,_accordionHandler){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fillFormAdditional=void 0,_exports.initAdditional=function(){document.getElementById("form_container").addEventListener("click",(async event=>{if("BUTTON"===event.target.nodeName||"I"===event.target.nodeName&&event.target.parentNode&&"BUTTON"===event.target.parentNode.nodeName){let element=null;if(element="I"===event.target.nodeName?event.target.parentNode:event.target,!element||!element.id.includes("add_info")||!1!==element.hidden)return;if(element.id.includes("remove")){let id=element.id.substring(element.id.lastIndexOf("_")+1);await async function(index){await(0,_utils.removeTinyEditor)("id_add_info_content_"+index),document.querySelector("#add_info_"+index).remove(),document.getElementById("udeh-form").dataset.changed="true"}(id),disableAddInfoDeleteButton(),await updateExistingHeaders(),document.getElementById("udeh-form").dataset.changed="true",event.stopImmediatePropagation()}}})),document.querySelector("#id_add_info").addEventListener("click",(async event=>{event.stopImmediatePropagation();let element=event.target;element&&!1===element.hidden&&(await addAdditionalInfo(!0),document.getElementById("udeh-form").dataset.changed="true",disableAddInfoDeleteButton())})),(0,_addtionnalInformationValidator.validateAdditionalInfo)()};let counterInfo=0;_exports.fillFormAdditional=async informations=>{if(informations&&informations.length>0)for(const information of informations){const i=informations.indexOf(information);0===i?((0,_utils.buildHiddenInput)(information.id,i,"fitem_id_add_info_title_"+i,"add_info_"),document.querySelector('[name = "add_info_0_id_value"]').setAttribute("value",information.id)):(null===document.getElementById("id_add_info_title_"+i)&&await addAdditionalInfo(!1),document.querySelector("#id_add_info_title_"+i).value=information.title,document.querySelector("#id_add_info_content_"+i).value=information.content,document.querySelector('[name = "add_info_'+i+'_id_value"]').setAttribute("value",information.id),await handleEditor(i))}disableAddInfoDeleteButton(),(0,_accordionHandler.initAccordionsAfterFillingForm)(),(0,_accordionHandler.handleAccordions)()};const updateExistingHeaders=async()=>{let headers=document.querySelectorAll('[aria-controls^="collapse_addinfo_header_"]');headers=Array.from(headers);for(const header of headers){const i=headers.indexOf(header);header.innerText=await(0,_str.get_string)("field","format_udehauthoring")+" "+(i+1)}},disableAddInfoDeleteButton=()=>{if(document.querySelectorAll('[id^="add_info_"]').length<=1){document.querySelector('[id^="id_remove_add_info_"]').hidden=!0}else{document.querySelectorAll('[id^="id_remove_add_info_"]').forEach((button=>{button.hidden=!1}))}};async function addAdditionalInfo(isNew){counterInfo+=1;let info=document.querySelector("#add_info_0").cloneNode(!0);info.setAttribute("id","add_info_"+counterInfo),info.querySelector("#course_addinfo_header_0").setAttribute("id","course_addinfo_header_"+counterInfo),info.querySelector('[href="#collapse_addinfo_header_0"]').innerText=await(0,_str.get_string)("field","format_udehauthoring")+" "+(document.querySelectorAll('[aria-controls^="collapse_addinfo_header_"]').length+1),info.querySelector('[href="#collapse_addinfo_header_0"]').setAttribute("aria-controls","collapse_addinfo_header_"+counterInfo),info.querySelector('[href="#collapse_addinfo_header_0"]').setAttribute("href","#collapse_addinfo_header_"+counterInfo),info.querySelector("#collapse_addinfo_header_0").setAttribute("id","collapse_addinfo_header_"+counterInfo),info.querySelector("#course_addinfo_0").setAttribute("id","course_addinfo_"+counterInfo),info.querySelector('[name="add_info_0_id_value"]')&&(info.querySelector('[name="add_info_0_id_value"]').setAttribute("name","add_info_"+counterInfo+"_id_value"),info.querySelector('[name="add_info_'+counterInfo+'_id_value"]').setAttribute("value",""),info.querySelector('[name="add_info_'+counterInfo+'_id_value"]').value="");let title=info.querySelector("#fitem_id_add_info_title_0");title.setAttribute("id","fitem_id_add_info_title_"+counterInfo),title.querySelector('[for="id_add_info_title_0"]').setAttribute("for","id_add_info_title_"+counterInfo),title.querySelector("#id_add_info_title_0").setAttribute("name","add_info_title_"+counterInfo),title.querySelector("#id_add_info_title_0").value="",title.querySelector("#id_add_info_title_0").setAttribute("id","id_add_info_title_"+counterInfo),title.querySelector("#id_error_add_info_title_0").setAttribute("id","id_error_add_info_title_"+counterInfo),(0,_utils.setEditorAfterCloning)(info,"content","add_info",counterInfo,null,isNew),(0,_utils.setDeleteButton)(info,"remove_add_info",counterInfo),document.querySelector("#displayable-form-additional-information-container").insertBefore(info,document.querySelector("#addinfo-add-container")),isNew&&((0,_accordionHandler.handleNewAccordion)("#course_addinfo_header_",counterInfo),await handleEditor(counterInfo))}const handleEditor=async addInfoIndex=>{window.$.ajax({type:"POST",url:"../handlers/ajax_editor_handler.php",data:{id:document.querySelector("#udeh-form").querySelector('[name = "course_id"]').value,elementId:"id_add_info_content_"+addInfoIndex,text:""},success:function(response){let draftIdElm=document.querySelector("#add_info_"+addInfoIndex).querySelector('[name = "add_info_content_'+addInfoIndex+'[itemid]"]');(0,_utils.initEditor)(response,draftIdElm)},error:async function(e){window.console.log(e)}})}}));

//# sourceMappingURL=additionalHelper.min.js.map