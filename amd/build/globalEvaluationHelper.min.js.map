{"version":3,"file":"globalEvaluationHelper.min.js","sources":["../src/globalEvaluationHelper.js"],"sourcesContent":["import {formatEditorAndFileManager, handleEmbed, removeTags} from \"./utils\";\nimport {validateEvaluationDataForm} from \"./validator/evaluationValidator\";\nimport {initRedactTools} from \"./toolHelper\";\n\n/**\n * @param {array} gloablevaluationplans\n */\nexport function initGlobalEvaluations(gloablevaluationplans) {\n    const decodedParams = JSON.parse(gloablevaluationplans);\n    let addButton = document.getElementById('id_add_global_evaluation');\n    addButton.hidden = true;\n    let accordions = document.querySelectorAll('[class*=\"single-accordion-container\"]');\n    accordions.forEach(function(accordion, i) {\n        let headerLink = accordion.firstElementChild.firstElementChild;\n        headerLink.href = '#collapseGlobalEvaluation' + (i);\n        headerLink.setAttribute('aria-controls', 'collapseGlobalEvaluation' + (i));\n        accordion.children[1].setAttribute('id', 'collapseGlobalEvaluation' + (i));\n        if (i > 0) {\n            accordion.children[1].setAttribute('class', 'collapse');\n            headerLink.setAttribute('aria-expanded', 'false');\n            headerLink.setAttribute('class', 'collapsed');\n        }\n        if (decodedParams[i].title) {\n            let title = decodedParams[i].title;\n            let headerContent = 'Evaluation Globale' + ' ' + (i + 1) + ' - ' + removeTags(title);\n            headerLink.innerHTML = headerContent.length > 70 ? headerContent.substring(0, 70) + '...' : headerContent;\n        } else {\n            headerLink.innerHTML = 'Evaluation Globale' + ' ' + (i + 1);\n        }\n\n        let currentEmbedSelector = accordion.querySelector('[class*=\"custom-switch\"]');\n        currentEmbedSelector.children[0].id = \"embed_selector_\" + i;\n        currentEmbedSelector.children[1].setAttribute('for', (\"embed_selector_\" + i));\n\n        let innerAccordion = accordion.querySelector('[id*=\"evaluation_preview_container_\"]');\n        innerAccordion.setAttribute('id', innerAccordion.getAttribute('id') + i);\n\n        innerAccordion.firstElementChild\n            .setAttribute('id', innerAccordion.firstElementChild.getAttribute('id') + i);\n        innerAccordion.firstElementChild.firstElementChild\n            .setAttribute('href', innerAccordion.firstElementChild.firstElementChild.getAttribute('href') + i);\n        innerAccordion.firstElementChild.firstElementChild\n            .setAttribute('aria-controls', innerAccordion.firstElementChild.firstElementChild.getAttribute('aria-controls') + i);\n\n        innerAccordion.children[1].setAttribute('id', innerAccordion.children[1].getAttribute('id') + i);\n\n        for (let j = 0; j < 3; j++) {\n            innerAccordion.children[1].firstElementChild.children[j]\n                .setAttribute('id', innerAccordion.children[1].firstElementChild.children[j].getAttribute('id') + i);\n            innerAccordion.children[1].firstElementChild.children[j].firstElementChild\n                // eslint-disable-next-line max-len\n                .setAttribute('id', innerAccordion.children[1].firstElementChild.children[j].firstElementChild.getAttribute('id') + i);\n            if (j !== 2) {\n                innerAccordion.children[1].firstElementChild.children[j].children[1]\n                    // eslint-disable-next-line max-len\n                    .setAttribute('id', innerAccordion.children[1].firstElementChild.children[j].children[1].getAttribute('id') + i);\n            }\n            let valToUse;\n            switch (j) {\n                case 0:\n                    valToUse = decodedParams[i].description;\n                    break;\n                case 1:\n                    valToUse = decodedParams[i].weight;\n                    break;\n                case 2:\n                    valToUse = decodedParams[i].associatedobjtext;\n                    break;\n            }\n            switch (j) {\n                case 0: {\n                    innerAccordion.children[1].firstElementChild.children[j].children[1]\n                        .innerHTML = valToUse;\n                    break;\n                }\n                case 1: {\n                    innerAccordion.children[1].firstElementChild.children[j].children[1]\n                        .innerHTML = removeTags(valToUse);\n                    break;\n                }\n                case 2: {\n                    for (let counter = 0; counter < valToUse.length; counter++) {\n                        let objContainer = document.createElement('div');\n                        objContainer.setAttribute('style', 'display: flex;');\n                        objContainer.setAttribute('id', 'evaluation_obj_content_' + i + '_' + counter);\n                        objContainer.innerHTML = valToUse[counter];\n                        innerAccordion.children[1].firstElementChild.children[j].appendChild(objContainer);\n                    }\n                    break;\n                }\n            }\n        }\n\n    });\n    formatEditorAndFileManager();\n    initPhpGlobalEvaluationValidation(decodedParams);\n    initRedactTools(2, decodedParams.map(value => value.toolname));\n}\n\n/**\n * @param {array} decodedParams\n */\nfunction initPhpGlobalEvaluationValidation(decodedParams) {\n    if (decodedParams.length > 0) {\n        for (let i = 0; i < decodedParams.length; i++) {\n            handleEmbed(('fitem_id_evaluation_introduction_embed_' + i), ('fitem_id_evaluation_introduction_' + i), i);\n        }\n        validateEvaluationDataForm(decodedParams.length);\n    }\n}\n"],"names":["gloablevaluationplans","decodedParams","JSON","parse","document","getElementById","hidden","querySelectorAll","forEach","accordion","i","headerLink","firstElementChild","href","setAttribute","children","title","headerContent","innerHTML","length","substring","currentEmbedSelector","querySelector","id","innerAccordion","getAttribute","j","valToUse","description","weight","associatedobjtext","counter","objContainer","createElement","appendChild","initPhpGlobalEvaluationValidation","map","value","toolname"],"mappings":"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"}