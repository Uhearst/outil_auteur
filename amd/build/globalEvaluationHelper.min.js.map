{"version":3,"file":"globalEvaluationHelper.min.js","sources":["../src/globalEvaluationHelper.js"],"sourcesContent":["import {formatEditorAndFileManager, handleEmbed, removeTags} from \"./utils\";\nimport {validateEvaluationDataForm} from \"./validator/evaluationValidator\";\nimport {initRedactTools} from \"./toolHelper\";\nimport {get_string as getString} from 'core/str';\nimport {handleAccordions, initAccordionsAfterFillingForm} from \"./accordionHandler\";\n\n/**\n * @param {array} gloablevaluationplans\n */\nexport async function initGlobalEvaluations(gloablevaluationplans) {\n    const decodedParams = JSON.parse(gloablevaluationplans);\n    let addButton = document.getElementById('id_add_global_evaluation');\n    addButton.hidden = true;\n    let accordions = document.querySelectorAll('[class*=\"single-accordion-container\"]');\n    for (let i = 0; i < accordions.length; i++) {\n        const accordion = accordions[i];\n        let headerLink = accordion.firstElementChild.firstElementChild;\n        headerLink.href = '#collapseGlobalEvaluation' + (i);\n        headerLink.setAttribute('aria-controls', 'collapseGlobalEvaluation' + (i));\n        accordion.children[1].setAttribute('id', 'collapseGlobalEvaluation' + (i));\n        if (i > 0) {\n            accordion.children[1].setAttribute('class', 'collapse');\n            headerLink.setAttribute('aria-expanded', 'false');\n            headerLink.setAttribute('class', 'collapsed');\n        }\n        let globalEvalTranslation = await getString('globalevaluation', 'format_udehauthoring');\n        if (decodedParams[i].title) {\n            let title = decodedParams[i].title;\n            let headerContent = globalEvalTranslation + ' ' + (i + 1) + ' - ' + removeTags(title);\n            headerLink.innerHTML = headerContent.length > 70 ? headerContent.substring(0, 70) + '...' : headerContent;\n        } else {\n            headerLink.innerHTML = globalEvalTranslation + ' ' + (i + 1);\n        }\n\n        let currentEmbedSelector = accordion.querySelector('[class*=\"custom-switch\"]');\n        currentEmbedSelector.children[0].id = \"embed_selector_\" + i;\n        currentEmbedSelector.children[1].setAttribute('for', (\"embed_selector_\" + i));\n\n        let innerAccordion = accordion.querySelector('[id*=\"evaluation_preview_container_\"]');\n        innerAccordion.setAttribute('id', innerAccordion.getAttribute('id') + i);\n\n        innerAccordion.firstElementChild\n            .setAttribute('id', innerAccordion.firstElementChild.getAttribute('id') + i);\n        innerAccordion.firstElementChild.firstElementChild\n            .setAttribute('href', innerAccordion.firstElementChild.firstElementChild.getAttribute('href') + i);\n        innerAccordion.firstElementChild.firstElementChild\n            .setAttribute('aria-controls', innerAccordion.firstElementChild.firstElementChild.getAttribute('aria-controls') + i);\n\n        innerAccordion.children[1].setAttribute('id', innerAccordion.children[1].getAttribute('id') + i);\n\n        for (let j = 0; j < 3; j++) {\n            innerAccordion.children[1].firstElementChild.children[j]\n                .setAttribute('id', innerAccordion.children[1].firstElementChild.children[j].getAttribute('id') + i);\n            innerAccordion.children[1].firstElementChild.children[j].firstElementChild\n                // eslint-disable-next-line max-len\n                .setAttribute('id', innerAccordion.children[1].firstElementChild.children[j].firstElementChild.getAttribute('id') + i);\n            if (j !== 2) {\n                innerAccordion.children[1].firstElementChild.children[j].children[1]\n                    // eslint-disable-next-line max-len\n                    .setAttribute('id', innerAccordion.children[1].firstElementChild.children[j].children[1].getAttribute('id') + i);\n            }\n            let valToUse;\n            switch (j) {\n                case 0:\n                    valToUse = decodedParams[i].description;\n                    break;\n                case 1:\n                    valToUse = decodedParams[i].weight;\n                    break;\n                case 2:\n                    valToUse = decodedParams[i].associatedobjtext;\n                    break;\n            }\n            switch (j) {\n                case 0: {\n                    innerAccordion.children[1].firstElementChild.children[j].children[1]\n                        .innerHTML = valToUse;\n                    break;\n                }\n                case 1: {\n                    innerAccordion.children[1].firstElementChild.children[j].children[1]\n                        .innerHTML = removeTags(valToUse);\n                    break;\n                }\n                case 2: {\n                    for (let counter = 0; counter < valToUse.length; counter++) {\n                        let objContainer = document.createElement('div');\n                        objContainer.setAttribute('style', 'display: flex;');\n                        objContainer.setAttribute('id', 'evaluation_obj_content_' + i + '_' + counter);\n                        objContainer.innerHTML = valToUse[counter];\n                        innerAccordion.children[1].firstElementChild.children[j].appendChild(objContainer);\n                    }\n                    break;\n                }\n            }\n        }\n\n    }\n    formatEditorAndFileManager();\n    initPhpGlobalEvaluationValidation(decodedParams);\n    initRedactTools(2, decodedParams.map(value => value.toolname));\n    handleAccordions();\n    initAccordionsAfterFillingForm();\n}\n\n/**\n * @param {array} decodedParams\n */\nfunction initPhpGlobalEvaluationValidation(decodedParams) {\n    if (decodedParams.length > 0) {\n        for (let i = 0; i < decodedParams.length; i++) {\n            handleEmbed(('fitem_id_evaluation_introduction_embed_' + i), ('fitem_id_evaluation_introduction_' + i), i);\n        }\n        validateEvaluationDataForm(decodedParams.length);\n    }\n}\n"],"names":["gloablevaluationplans","decodedParams","JSON","parse","document","getElementById","hidden","accordions","querySelectorAll","i","length","accordion","headerLink","firstElementChild","href","setAttribute","children","globalEvalTranslation","title","headerContent","innerHTML","substring","currentEmbedSelector","querySelector","id","innerAccordion","getAttribute","j","valToUse","description","weight","associatedobjtext","counter","objContainer","createElement","appendChild","initPhpGlobalEvaluationValidation","map","value","toolname"],"mappings":"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"}