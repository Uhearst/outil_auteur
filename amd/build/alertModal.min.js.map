{"version":3,"file":"alertModal.min.js","sources":["../src/alertModal.js"],"sourcesContent":["import {get_string as getString} from 'core/str';\n\nlet currentIndex = null;\nlet currentName = null;\n\n/**\n *\n */\nexport async function handleModal() {\n\n    await buildModal();\n    toggleModal();\n    deleteToolFromModal();\n}\n\n/**\n *\n */\nasync function buildModal() {\n    let modalContainer = document.createElement('div');\n    let modalDialog = document.createElement('div');\n    let modalContent = document.createElement('div');\n    let modalHeader = document.createElement('div');\n    let modalTitle = document.createElement('h5');\n    let modalBody = document.createElement('div');\n    let modalFooter = document.createElement('div');\n    let buttonClose = document.createElement('button');\n    let buttonCloseHeader = document.createElement('button');\n    let buttonSave = document.createElement('button');\n\n    modalContainer.setAttribute('class', 'modal fade alert-modal');\n    modalContainer.setAttribute('id', 'alertModal');\n    modalContainer.setAttribute('tabindex', '-1');\n    modalContainer.setAttribute('role', 'dialog');\n    modalContainer.setAttribute('aria-labelledby', 'alertModalLabel');\n    modalContainer.setAttribute('aria-hidden', 'true');\n\n    modalDialog.setAttribute('class', 'modal-dialog');\n    modalDialog.setAttribute('role', 'document');\n\n    modalContent.setAttribute('class', 'modal-content alert-modal-content');\n\n    modalHeader.setAttribute('class', 'modal-header');\n\n    modalTitle.setAttribute('class', 'modal-title');\n    modalTitle.setAttribute('id', 'alertModalLabel');\n    modalTitle.innerHTML = await getString('alertmodaltitle', 'format_udehauthoring');\n\n    buttonCloseHeader.setAttribute('type', 'button');\n    buttonCloseHeader.setAttribute('class', 'close');\n    buttonCloseHeader.setAttribute('data-dismiss', 'modal');\n    buttonCloseHeader.setAttribute('aria-label', 'Close');\n    buttonCloseHeader.innerHTML = '<span aria-hidden=\"true\">&times;</span>';\n\n    modalBody.setAttribute('class', 'modal-body');\n\n    modalFooter.setAttribute('class', 'modal-footer');\n\n    buttonClose.setAttribute('type', 'button');\n    buttonClose.setAttribute('class', 'btn btn-secondary');\n    buttonClose.setAttribute('data-dismiss', 'modal');\n    buttonClose.innerHTML = await getString('cancel');\n\n    buttonSave.setAttribute('type', 'button');\n    buttonSave.setAttribute('class', 'btn btn-primary');\n    buttonSave.setAttribute('id', 'btn_delete_tool');\n    buttonSave.innerHTML = await getString('delete');\n\n    modalFooter.appendChild(buttonClose);\n    modalFooter.appendChild(buttonSave);\n\n    modalHeader.appendChild(modalTitle);\n    modalHeader.appendChild(buttonCloseHeader);\n\n    modalContent.appendChild(modalHeader);\n    modalContent.appendChild(modalBody);\n    modalContent.appendChild(modalFooter);\n\n    modalDialog.appendChild(modalContent);\n\n    modalContainer.appendChild(modalDialog);\n    let form = document.getElementById('udeh-form');\n    if (form) {\n        form.appendChild(modalContainer);\n    }\n\n\n}\n\n/**\n *\n */\nfunction toggleModal() {\n    let buttons = document.querySelectorAll('[name*=\"[delete_tool]\"]');\n    buttons.forEach(button => {\n        button.addEventListener('click', async e => {\n            e.stopImmediatePropagation();\n            if (location.href.includes('subquestion') || location.href.includes('globalevaluation')) {\n                currentIndex = button.name.slice(button.name.indexOf('[') + 1,\n                    button.name.indexOf(']'));\n            }\n            if (window.location.pathname.includes('subquestion')) {\n                currentName = document.querySelector('[id = \"exploration_tool_name_' + currentIndex + '\"]').innerHTML;\n            } else {\n                if (currentIndex === null) {\n                    currentName = document.querySelector('[id = \"evaluation_tool_name\"]').innerHTML;\n                } else {\n                    currentName = document.querySelector('[id = \"evaluation_tool_name_' + currentIndex + '\"]').innerHTML;\n                }\n            }\n            let modalBody = document.querySelector('#alertModal').querySelector('.modal-body');\n            modalBody.innerHTML = await getString('alertmodalbody', 'format_udehauthoring', currentName);\n            window.$('#alertModal').modal('toggle');\n        });\n    });\n}\n\n/**\n *\n */\nfunction deleteToolFromModal() {\n    let deleteButton = document.getElementById('btn_delete_tool');\n\n    deleteButton.addEventListener('click', () => {\n        let cmid = null;\n        let id = null;\n        let type = null;\n        if(window.location.pathname.includes('subquestion')) {\n            type = 1;\n            cmid = document.querySelector('[name = \"exploration_tool_cmid[' + currentIndex + ']\"]');\n            id = document.querySelector('[name = \"exploration_id[' + currentIndex + ']\"]');\n        } else {\n            type = 2;\n            if(currentIndex === null) {\n                cmid = document.querySelector('[name = \"evaluation_tool_cmid\"]');\n                id = document.querySelector('[name = \"id\"]');\n            } else {\n                cmid = document.querySelector('[name = \"evaluation_tool_cmid[' + currentIndex + ']\"]');\n                id = document.querySelector('[name = \"evaluation_id[' + currentIndex + ']\"]');\n            }\n        }\n        window.$.ajax(\n            {\n                type: \"POST\",\n                url: \"../handlers/ajax_tool_handler.php\",\n                data: {\n                    cmid: cmid.value,\n                    id: id.value,\n                    type: type,\n                },\n                success: function() {\n                    window.$('#alertModal').modal('toggle');\n                    if (currentIndex === null) {\n                        document.getElementById('fgroup_id_url_group').style = \"display:none;\";\n                        document.querySelector('[name*=\"generate_tool\"]').disabled = false;\n                        let select = document.getElementById('id_evaluation_tool');\n                        select.disabled = false;\n                    } else {\n                        document.getElementById('fgroup_id_url_group_' + currentIndex).style = \"display:none;\";\n                        document.getElementById('id_tool_group_' + currentIndex + '_generate_tool').disabled = false;\n                        if (window.location.pathname.includes('subquestion')) {\n                            document.getElementById('id_tool_group_' + currentIndex + '_exploration_tool').disabled = false;\n                        } else {\n                            document.getElementById('id_tool_group_' + currentIndex + '_evaluation_tool').disabled = false;\n                        }\n\n                    }\n                    currentIndex = null;\n                    window.location.reload();\n                },\n                error: function() {\n                    window.console.log('failure');\n                }\n            });\n    });\n}"],"names":["modalContainer","document","createElement","modalDialog","modalContent","modalHeader","modalTitle","modalBody","modalFooter","buttonClose","buttonCloseHeader","buttonSave","setAttribute","innerHTML","appendChild","form","getElementById","buildModal","querySelectorAll","forEach","button","addEventListener","async","e","stopImmediatePropagation","location","href","includes","currentIndex","name","slice","indexOf","currentName","window","pathname","querySelector","$","modal","cmid","id","type","ajax","url","data","value","success","style","disabled","reload","error","console","log"],"mappings":"kNAmBQA,eAAiBC,SAASC,cAAc,OACxCC,YAAcF,SAASC,cAAc,OACrCE,aAAeH,SAASC,cAAc,OACtCG,YAAcJ,SAASC,cAAc,OACrCI,WAAaL,SAASC,cAAc,MACpCK,UAAYN,SAASC,cAAc,OACnCM,YAAcP,SAASC,cAAc,OACrCO,YAAcR,SAASC,cAAc,UACrCQ,kBAAoBT,SAASC,cAAc,UAC3CS,WAAaV,SAASC,cAAc,UAExCF,eAAeY,aAAa,QAAS,0BACrCZ,eAAeY,aAAa,KAAM,cAClCZ,eAAeY,aAAa,WAAY,MACxCZ,eAAeY,aAAa,OAAQ,UACpCZ,eAAeY,aAAa,kBAAmB,mBAC/CZ,eAAeY,aAAa,cAAe,QAE3CT,YAAYS,aAAa,QAAS,gBAClCT,YAAYS,aAAa,OAAQ,YAEjCR,aAAaQ,aAAa,QAAS,qCAEnCP,YAAYO,aAAa,QAAS,gBAElCN,WAAWM,aAAa,QAAS,eACjCN,WAAWM,aAAa,KAAM,mBAC9BN,WAAWO,gBAAkB,mBAAU,kBAAmB,wBAE1DH,kBAAkBE,aAAa,OAAQ,UACvCF,kBAAkBE,aAAa,QAAS,SACxCF,kBAAkBE,aAAa,eAAgB,SAC/CF,kBAAkBE,aAAa,aAAc,SAC7CF,kBAAkBG,UAAY,0CAE9BN,UAAUK,aAAa,QAAS,cAEhCJ,YAAYI,aAAa,QAAS,gBAElCH,YAAYG,aAAa,OAAQ,UACjCH,YAAYG,aAAa,QAAS,qBAClCH,YAAYG,aAAa,eAAgB,SACzCH,YAAYI,gBAAkB,mBAAU,UAExCF,WAAWC,aAAa,OAAQ,UAChCD,WAAWC,aAAa,QAAS,mBACjCD,WAAWC,aAAa,KAAM,mBAC9BD,WAAWE,gBAAkB,mBAAU,UAEvCL,YAAYM,YAAYL,aACxBD,YAAYM,YAAYH,YAExBN,YAAYS,YAAYR,YACxBD,YAAYS,YAAYJ,mBAExBN,aAAaU,YAAYT,aACzBD,aAAaU,YAAYP,WACzBH,aAAaU,YAAYN,aAEzBL,YAAYW,YAAYV,cAExBJ,eAAec,YAAYX,iBACvBY,KAAOd,SAASe,eAAe,aAC/BD,MACAA,KAAKD,YAAYd,gBAzEfiB,GAmFQhB,SAASiB,iBAAiB,2BAChCC,SAAQC,SACZA,OAAOC,iBAAiB,SAASC,MAAAA,IAC7BC,EAAEC,4BACEC,SAASC,KAAKC,SAAS,gBAAkBF,SAASC,KAAKC,SAAS,uBAChEC,aAAeR,OAAOS,KAAKC,MAAMV,OAAOS,KAAKE,QAAQ,KAAO,EACxDX,OAAOS,KAAKE,QAAQ,OAGxBC,YADAC,OAAOR,SAASS,SAASP,SAAS,eACpB1B,SAASkC,cAAc,gCAAkCP,aAAe,MAAMf,UAEvE,OAAjBe,aACc3B,SAASkC,cAAc,iCAAiCtB,UAExDZ,SAASkC,cAAc,+BAAiCP,aAAe,MAAMf,UAGnFZ,SAASkC,cAAc,eAAeA,cAAc,eAC1DtB,gBAAkB,mBAAU,iBAAkB,uBAAwBmB,aAChFC,OAAOG,EAAE,eAAeC,MAAM,gBASnBpC,SAASe,eAAe,mBAE9BK,iBAAiB,SAAS,SAC/BiB,KAAO,KACPC,GAAK,KACLC,KAAO,KACRP,OAAOR,SAASS,SAASP,SAAS,gBACjCa,KAAO,EACPF,KAAOrC,SAASkC,cAAc,kCAAoCP,aAAe,OACjFW,GAAKtC,SAASkC,cAAc,2BAA6BP,aAAe,SAExEY,KAAO,EACa,OAAjBZ,cACCU,KAAOrC,SAASkC,cAAc,mCAC9BI,GAAKtC,SAASkC,cAAc,mBAE5BG,KAAOrC,SAASkC,cAAc,iCAAmCP,aAAe,OAChFW,GAAKtC,SAASkC,cAAc,0BAA4BP,aAAe,SAG/EK,OAAOG,EAAEK,KACL,CACID,KAAM,OACNE,IAAK,oCACLC,KAAM,CACFL,KAAMA,KAAKM,MACXL,GAAIA,GAAGK,MACPJ,KAAMA,MAEVK,QAAS,WACLZ,OAAOG,EAAE,eAAeC,MAAM,UACT,OAAjBT,cACA3B,SAASe,eAAe,uBAAuB8B,MAAQ,gBACvD7C,SAASkC,cAAc,2BAA2BY,UAAW,EAChD9C,SAASe,eAAe,sBAC9B+B,UAAW,IAElB9C,SAASe,eAAe,uBAAyBY,cAAckB,MAAQ,gBACvE7C,SAASe,eAAe,iBAAmBY,aAAe,kBAAkBmB,UAAW,EACnFd,OAAOR,SAASS,SAASP,SAAS,eAClC1B,SAASe,eAAe,iBAAmBY,aAAe,qBAAqBmB,UAAW,EAE1F9C,SAASe,eAAe,iBAAmBY,aAAe,oBAAoBmB,UAAW,GAIjGnB,aAAe,KACfK,OAAOR,SAASuB,UAEpBC,MAAO,WACHhB,OAAOiB,QAAQC,IAAI,sBAzKnCvB,aAAe,KACfI,YAAc"}