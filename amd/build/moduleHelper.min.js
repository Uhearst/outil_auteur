define("format_udehauthoring/moduleHelper",["exports","./utils","core/str","./accordionHandler"],(function(_exports,_utils,_str,_accordionHandler){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fillFormModules=async function(modules){for(const module of modules){const i=modules.indexOf(module);0===i?((0,_utils.buildHiddenInput)(module.id,i,"fitem_id_section_title_0","section_"),document.querySelector("#section_isvisible_0").checked="1"===module.isvisiblepreview,document.querySelector('[name = "section_0_id_value"]').setAttribute("value",module.id)):(null===document.getElementById("id_section_title_"+i)&&await addModule(!1),document.querySelector("#section_isvisible_"+i).checked="1"===module.isvisiblepreview,editorFields.forEach((editorField=>{document.querySelector("#id_section_"+editorField+"_"+i).value=module[editorField]})),document.querySelector('[name = "section_'+i+'_id_value"]').setAttribute("value",module.id),await handleEditor(i))}(0,_utils.prepareActionButton)([{type:0,id:"module_0"},{type:1,id:"module"}]),disableModuleDeleteButton(),(0,_accordionHandler.initAccordionsAfterFillingForm)(),(0,_accordionHandler.handleAccordions)()},_exports.initModules=function(){const formContainer=document.getElementById("form_container");let addButton=document.querySelector("#id_add_module");formContainer.addEventListener("click",(async event=>{if("BUTTON"===event.target.nodeName||"I"===event.target.nodeName&&event.target.parentNode&&"BUTTON"===event.target.parentNode.nodeName){let element=null;if(element="I"===event.target.nodeName?event.target.parentNode:event.target,!element||!element.id.includes("module")||!1!==element.hidden)return;if(element.id.includes("remove")){let id=element.id.substring(element.id.lastIndexOf("_")+1);await async function(index){let module=document.querySelector("#row_course_module_container_"+index);for(const editorField of editorFields)await(0,_utils.removeTinyEditor)("id_section_"+editorField+"_"+index);module.remove(),await async function(index){let modules=document.querySelectorAll('[id^="row_course_module_container_"]');for(const module of modules)if(parseInt(module.id.substring(module.id.lastIndexOf("_")+1))>parseInt(index)){let currentIndex=parseInt(module.id.substring(module.id.lastIndexOf("_")+1));module.setAttribute("id","row_course_module_container_"+(currentIndex-1));let header=module.querySelector(".accordion-header");header.setAttribute("id","course_module_header_"+(currentIndex-1)),header.querySelector('[data-toggle="collapse"]').setAttribute("href","#collapse_module_"+(currentIndex-1)),header.querySelector('[data-toggle="collapse"]').setAttribute("aria-controls","collapse_module_"+(currentIndex-1)),header.querySelector('[data-toggle="collapse"]').innerHTML=await(0,_str.get_string)("section","format_udehauthoring")+" "+currentIndex,header.querySelector("#section_isvisible_"+currentIndex).setAttribute("name","section_isvisible_"+(currentIndex-1)),header.querySelector("#section_isvisible_"+currentIndex).setAttribute("id","section_isvisible_"+(currentIndex-1));let collapsible=module.querySelector(".collapse");collapsible.setAttribute("id","collapse_module_"+(currentIndex-1)),collapsible.firstElementChild.setAttribute("id","course_module_content_"+(currentIndex-1)),module.querySelector('[name="section_'+currentIndex+'_id_value"]').setAttribute("name","section_"+(currentIndex-1)+"_id_value"),await(0,_utils.updateEditorAndLabel)(module,currentIndex,"title","section"),await(0,_utils.updateEditorAndLabel)(module,currentIndex,"question","section"),await(0,_utils.updateEditorAndLabel)(module,currentIndex,"description","section"),await handleEditor(currentIndex-1)}}(index),await updateAddModuleButton(),disableModuleDeleteButton(),document.querySelectorAll('[id^="fitem_id_remove_module_"]').forEach((function(button,index){button.setAttribute("id","fitem_id_remove_module_"+index);let buttonElm=button.querySelector('[type="button"]');buttonElm.setAttribute("name","remove_module_"+index),buttonElm.setAttribute("id","id_remove_module_"+index)})),counterModules-=1}(id),document.getElementById("udeh-form").dataset.changed="true",event.stopImmediatePropagation()}}})),addButton.addEventListener("click",(async event=>{if("BUTTON"===event.target.nodeName||"I"===event.target.nodeName&&event.target.parentNode&&"BUTTON"===event.target.parentNode.nodeName){event.stopImmediatePropagation();let element=null;if(element="I"===event.target.nodeName?event.target.parentNode:event.target,!element||!element.id.includes("module")||!1!==element.hidden)return;await addModule(!0),document.getElementById("udeh-form").dataset.changed="true"}}));let addingButtonsContainer=document.querySelectorAll("[class='col-md-9 form-inline align-items-start felement']");addingButtonsContainer&&addingButtonsContainer.forEach((function(addingButtonContainer){if("button"===addingButtonContainer.dataset.fieldtype){addingButtonContainer.removeAttribute("class"),addingButtonContainer.childNodes.forEach((child=>{child.type&&"button"===child.type&&child.classList.remove("btn-secondary")}))}}));let addingButtons=document.querySelectorAll("[class*='add_action_button']");addingButtons&&addingButtons.forEach((function(addingButton){addingButton.childNodes.forEach((child=>{child.removeAttribute("class")}))}));disableModuleDeleteButton()};const editorFields=["title","question","description"];let counterModules=0;async function addModule(fromBtnClick){counterModules+=1;let module=document.querySelector("#row_course_module_container_0").cloneNode(!0);module.setAttribute("id","row_course_module_container_"+counterModules),module.querySelector("#course_module_header_0").setAttribute("id","course_module_header_"+counterModules),module.querySelector("#section_isvisible_0").setAttribute("name","section_isvisible_"+counterModules),module.querySelector("#section_isvisible_0").setAttribute("id","section_isvisible_"+counterModules),module.querySelector('[for="section_isvisible_0"]').setAttribute("for","section_isvisible_"+counterModules),module.querySelector('[href="#collapse_module_header_0"]').innerText=await(0,_str.get_string)("section","format_udehauthoring")+" "+(counterModules+1),module.querySelector('[href="#collapse_module_header_0"]').setAttribute("aria-controls","collapse_module_header_"+counterModules),module.querySelector('[href="#collapse_module_header_0"]').setAttribute("href","#collapse_module_header_"+counterModules),module.querySelector("#collapse_module_header_0").setAttribute("id","collapse_module_header_"+counterModules),module.querySelector("#course_module_0").setAttribute("id","course_module_"+counterModules),module.querySelector('[name="section_0_id_value"]')&&(module.querySelector('[name="section_0_id_value"]').setAttribute("value",""),module.querySelector('[name="section_0_id_value"]').setAttribute("name","section_"+counterModules+"_id_value")),editorFields.forEach((editorField=>{(0,_utils.setEditorAfterCloning)(module,editorField,"section",counterModules,null,fromBtnClick)})),(0,_utils.setDeleteButton)(module,"remove_module",counterModules),document.querySelector("#displayable-form-sections-container").insertBefore(module,document.querySelector("#section-add-container")),await updateAddModuleButton(),disableModuleDeleteButton(),fromBtnClick&&((0,_accordionHandler.handleNewAccordion)("#course_module_header_",counterModules),await handleEditor(counterModules))}const handleEditor=async counter=>{editorFields.forEach((editorField=>{window.$.ajax({type:"POST",url:"../handlers/ajax_editor_handler.php",data:{id:document.querySelector("#udeh-form").querySelector('[name = "course_id"]').value,elementId:"id_section_"+editorField+"_"+counter,text:""},success:function(response){let draftIdElm=document.querySelector("#row_course_module_container_"+counter).querySelector('[name = "section_'+editorField+"_"+counter+'[itemid]"]');(0,_utils.initEditor)(response,draftIdElm)},error:async function(e){window.console.log(e)}})}))};function disableModuleDeleteButton(){if(1===document.querySelectorAll('[id^="row_course_module_container_"]').length){document.getElementById("id_remove_module_0").hidden=!0}else{document.querySelectorAll('[id^="id_remove_module"]').forEach((button=>{button.hidden=!1}))}}async function updateAddModuleButton(){let x=document.querySelectorAll('[id^="row_course_module_container_"]');document.getElementById("section-add-container").querySelector(".add-text").innerHTML=await(0,_str.get_string)("section","format_udehauthoring")+" "+(x.length+1)}}));

//# sourceMappingURL=moduleHelper.min.js.map