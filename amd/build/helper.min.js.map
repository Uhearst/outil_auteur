{"version":3,"file":"helper.min.js","sources":["../src/helper.js"],"sourcesContent":["/* eslint-disable no-undef */\nimport {initModules} from \"./moduleHelper\";\nimport {initObjectives} from \"./objectiveHelper\";\nimport {fillFormObjectives} from \"./objectiveHelper\";\nimport {fillFormAdditional} from \"./additionalHelper\";\nimport {fillFormModules} from \"./moduleHelper\";\nimport {\n    appendAnchorToForm,\n    appendStyleToAnchorMenuSection,\n    formatEditorAndFileManager\n} from \"./utils\";\nimport {fillFormEvaluations, initEvaluations} from \"./evaluationHelper\";\nimport {initCourse} from \"./courseHelper\";\nimport {initAdditional} from \"./additionalHelper\";\nimport {addNotification} from \"./notificationHelper\";\nimport {get_string as getString} from 'core/str';\n\n/**\n *\n */\nfunction handleInit() {\n    let n = window.location.pathname.lastIndexOf('/');\n    let page = window.location.pathname.substring(n + 1);\n    let anchor = window.location.href.includes(\"#\") ?\n        window.location.href.substring(window.location.href.lastIndexOf('#') + 1) : 'displayable-form-informations-container';\n    if (page.includes('course')) {\n        appendAnchorToForm(anchor);\n        if (anchor === 'displayable-form-objectives-container') {\n            initObjectives();\n            appendStyleToAnchorMenuSection('item-teachingobjectives');\n        } else if (anchor === 'displayable-form-sections-container') {\n            initModules();\n            appendStyleToAnchorMenuSection('item-coursesections');\n        } else if (anchor === 'displayable-form-evaluations-container') {\n            initEvaluations();\n            appendStyleToAnchorMenuSection('item-learningevaluations');\n        } else if (anchor === 'displayable-form-additional-information-container') {\n            initAdditional();\n            appendStyleToAnchorMenuSection('item-additionalinformation');\n        } else {\n            initCourse();\n            appendStyleToAnchorMenuSection('item-generalinformations');\n        }\n    }\n    window.$(document).scrollTop(0);\n    formatEditorAndFileManager();\n}\n\n/**\n * @param {array} params\n */\nfunction handleFillForms(params) {\n    let n = window.location.pathname.lastIndexOf('/');\n    let page = window.location.pathname.substring(n + 1);\n    let anchor = window.location.href.includes(\"#\") ?\n        window.location.href.substring(window.location.href.lastIndexOf('#') + 1) : 'displayable-form-informations-container';\n    if (page.includes('course')) {\n        let parsedResponse = null;\n        const decodedParams = JSON.parse(params);\n        window.$.ajax(\n            {\n                type: \"POST\",\n                url: \"../handlers/ajax_course_handler.php\",\n                data: {\n                    courseId: decodedParams.courseId\n                },\n                success: async function(response) {\n                    parsedResponse = JSON.parse(response);\n                    if (anchor === 'displayable-form-objectives-container') {\n                        await fillFormObjectives(parsedResponse.data.teachingobjectives);\n                    } else if (anchor === 'displayable-form-sections-container') {\n                        await fillFormModules(parsedResponse.data.sections);\n                    } else if (anchor === 'displayable-form-evaluations-container') {\n                        await fillFormEvaluations(parsedResponse.data.evaluations,\n                            parsedResponse.data.sections);\n                    } else if (anchor === 'displayable-form-additional-information-container') {\n                        await fillFormAdditional(parsedResponse.data.additionalinformation);\n                    }\n                    formatEditorAndFileManager();\n                },\n                error: function () {\n                    window.console.log('failure');\n                }\n            });\n\n    }\n}\n\n/**\n *\n */\nexport function init() {\n    handleInit();\n    window.addEventListener('hashchange', function () {\n        handleInit();\n    });\n}\n\n/**\n * @param {array} array\n */\nexport function fillForm(array) {\n    handleFillForms(array);\n    window.addEventListener('hashchange', function () {\n        handleFillForms(array);\n    });\n}\n\n/**\n *\n */\nexport function initSaveWarningModal() {\n    let links = document.querySelectorAll('.router');\n    links.forEach(link => {\n        link.addEventListener('click', (e) => {\n            e.preventDefault();\n            if (e.target.nodeName === 'A') {\n                e.preventDefault();\n                saveWarningModal(e.target.href);\n            } else if (e.target.closest('a') !== '') {\n                e.preventDefault();\n                saveWarningModal(e.target.closest('a').href);\n            } else if (e.target.first('a') !== '') {\n                e.preventDefault();\n                saveWarningModal(e.target.first('a').href);\n            }\n        });\n    });\n}\n\n/**\n * @param {string | null} href\n * @param {int} courseId\n */\nexport function saveWarningModal(href, courseId = 0) {\n    let form = document.getElementById('udeh-form');\n    if (form.dataset.changed === 'true') {\n        let modalContainer = window.$(\"#save-warning-container\");\n        modalContainer.show();\n        let modal = window.$(\".save-warning\");\n        let modalButton = document.querySelector(\".save-warning\").querySelector('.btn-secondary');\n\n        getString(courseId !== 0 ? 'publishwarning' : 'savewarning', 'format_udehauthoring')\n            .then(\n                (valueString) => {\n                    let body = document.querySelector(\".save-warning\").querySelector('p');\n                    body.innerHTML = valueString;\n                }\n            )\n            .catch(() => {\n                document.querySelector(\".save-warning\").querySelector('p').innerHTML =\n                    'ÃŠtes-vous certain(e) de vouloir publier sans sauvegarder?';\n            });\n\n        let key = '';\n        let component = '';\n        if (courseId !== 0) {\n            key = 'publish';\n            component = 'format_udehauthoring';\n        } else {\n            key = 'continue';\n            component = 'theme_remui';\n        }\n\n        getString(key, component)\n            .then(\n                (valueString) => {\n                    modalButton.innerHTML = valueString;\n                }\n            )\n            .catch(() => {\n                modalButton.innerHTML('Publier');\n            });\n\n        modal.show();\n        modalButton.addEventListener('click', () => {\n            modalContainer.hide();\n            modal.hide();\n            if (href) {\n                form.dataset.changed = 'false';\n                window.location.href = href;\n            } else if (courseId) {\n                publishCourse(courseId);\n            }\n        });\n\n        document.querySelector(\".save-warning\").querySelector('.btn-primary').addEventListener('click', () => {\n            modalContainer.hide();\n            modal.hide();\n        });\n    } else {\n        if (href) {\n            window.location.href = href;\n        } else if (courseId) {\n            publishCourse(courseId);\n        }\n    }\n}\n\n/**\n * @param {int} courseId\n */\nfunction publishCourse(courseId) {\n    window.$(\"#save-warning-container\").show();\n    window.$(\"#progress-circle\").show();\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    window.$.ajax({\n        type: \"POST\",\n        url: \"../handlers/ajax_export_handler.php\",\n        data: {\n            courseId: courseId,\n            id: urlParams.get('id')\n        },\n        success: async function(response) {\n            let parsedResponse = JSON.parse(response);\n            if (parsedResponse.error) {\n                addNotification(\n                    await getString('notificationerrorpublishcourse', 'format_udehauthoring') + ' ' + parsedResponse.msg,\n                    2);\n            } else {\n                let previewButton = document.querySelector('#preview-button');\n                if (parsedResponse.data.hasOwnProperty('previewurls')) {\n                    previewButton.setAttribute('data-urls', JSON.stringify(parsedResponse.data.previewurls));\n                } else {\n                    previewButton.setAttribute('data-url', parsedResponse.data.previewurl);\n                }\n                addNotification(await getString('notificationpublishcourse', 'format_udehauthoring'), 1);\n            }\n            window.$(\"#save-warning-container\").hide();\n            window.$(\"#progress-circle\").hide();\n        },\n        error: async function() {\n            window.$(\"#save-warning-container\").hide();\n            window.$(\"#progress-circle\").hide();\n            addNotification(await getString('notificationerrorpublishcourse', 'format_udehauthoring'), 2);\n        }\n    });\n}\n\n/**\n * @param {int} courseId\n */\nexport function exportCourse(courseId) {\n    let publishButton = document.getElementById('publishCourse');\n    publishButton.addEventListener('click', function (evt) {\n        evt.preventDefault();\n        saveWarningModal(null, courseId);\n    });\n}\n\n/**\n * @param {array} Ids\n */\nexport function publishCoursePlan(Ids) {\n    let publishButton = document.getElementById('publishCoursePlan');\n    publishButton.addEventListener('click', function() {\n        window.open(\"../handlers/pdf_syllabus_handler.php?courseId=\" + Ids[1]);\n    });\n}\n\n"],"names":["handleInit","n","window","location","pathname","lastIndexOf","page","substring","anchor","href","includes","$","document","scrollTop","handleFillForms","params","parsedResponse","decodedParams","JSON","parse","ajax","type","url","data","courseId","success","async","response","teachingobjectives","sections","evaluations","additionalinformation","error","console","log","saveWarningModal","form","getElementById","dataset","changed","modalContainer","show","modal","modalButton","querySelector","then","valueString","innerHTML","catch","key","component","addEventListener","hide","publishCourse","queryString","search","urlParams","URLSearchParams","id","get","msg","previewButton","hasOwnProperty","setAttribute","stringify","previewurls","previewurl","evt","preventDefault","array","querySelectorAll","forEach","link","e","target","nodeName","closest","first","Ids","open"],"mappings":"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"}