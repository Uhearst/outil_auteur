define("format_udehauthoring/phpHelper",["exports","./utils","./toolHelper","./validator/sectionValidator","./validator/validateSubquestionForm","core/str","./accordionHandler"],(function(_exports,_utils,_toolHelper,_sectionValidator,_validateSubquestionForm,_str,_accordionHandler){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=async function(params){const decodedParams=JSON.parse(params);await async function(type){0===type?(elementName=await(0,_str.get_string)("section","format_udehauthoring"),subElementsName=[await(0,_str.get_string)("subquestion","format_udehauthoring")]):(elementName=await(0,_str.get_string)("subquestion","format_udehauthoring"),subElementsName=[await(0,_str.get_string)("exploration","format_udehauthoring"),await(0,_str.get_string)("resource","format_udehauthoring")])}(decodedParams.type),courseId=decodedParams.courseId,sectionId=decodedParams.sectionId,subQuestionId=decodedParams.subQuestionId,type=decodedParams.type,toolList=decodedParams.toolList,0===type?(window.$.ajax({type:"POST",url:"../handlers/ajax_module_handler.php",data:{courseId:courseId},success:function(response){JSON.parse(response).data.forEach((function(module,i){parseInt(module.id)===sectionId&&(element=module,counterElement=i)})),updatePreviewHeader(!1),subElementsName.forEach((subElementName=>{updateCurrentAccordions(subElementName)}))},error:function(){window.console.log("failure")}}),(0,_sectionValidator.validateSectionForm)(),(0,_utils.handleEmbed)("fitem_id_section_introduction_embed","fitem_id_section_introduction")):(window.$.ajax({type:"POST",url:"../handlers/ajax_subquestion_handler.php",data:{sectionId:sectionId,courseId:courseId},success:function(response){let parsedResponse=JSON.parse(response);parsedResponse.data.forEach((function(subQuestion,i){parseInt(subQuestion.id)===subQuestionId&&(element=subQuestion,counterElement=parsedResponse.sectionIndex,counterSubElement=i)})),updatePreviewHeader(!0),subElementsName.forEach((subElementName=>{updateCurrentAccordions(subElementName)}))},error:function(){window.console.log("failure")}}),(0,_toolHelper.initRedactTools)(1,toolList),function(){let freeTypesTextArea=document.querySelectorAll('[name^="exploration_activity_type["]');for(let i=0;i<freeTypesTextArea.length;i++)hideShowFreeActivity(freeTypesTextArea,i),freeTypesTextArea[i].addEventListener("change",(()=>{hideShowFreeActivity(freeTypesTextArea,i)}))}(),(0,_validateSubquestionForm.validateSubquestionForm)()),document.querySelectorAll('[name^="add"]').forEach((function(addButton,i){if("submit"===addButton.getAttribute("type")){let colContainers=document.querySelectorAll(".add_action_button"),icon=document.createElement("i"),updatedButton=changeTag(addButton,"button");updatedButton.setAttribute("class","btn add-button"),icon.setAttribute("class","fa fa-plus-circle fa-2x"),updatedButton.appendChild(icon),colContainers[i].appendChild(updatedButton),addButton.hidden=!0}})),function(isSectionPage,isSubQuestionPage){let removeButtons=document.querySelectorAll('[name^="remove_"]');removeButtons.forEach((removeButton=>{if("submit"===removeButton.getAttribute("type")){let icon=document.createElement("i"),updatedButton=changeTag(removeButton,"button");updatedButton.setAttribute("class","btn remove-button"),icon.setAttribute("class","fa fa-minus-circle fa-2x"),updatedButton.appendChild(icon),removeButton.parentElement.appendChild(updatedButton),removeButton.parentElement.classList.add("remove_action_button"),removeButton.hidden=!0}})),isSectionPage&&!isSubQuestionPage?disableRemoveButton([...removeButtons],"id_remove_section"):isSubQuestionPage&&(disableRemoveButton([...removeButtons].filter((removeButton=>removeButton.id.includes("exploration"))),"id_remove_exploration"),disableRemoveButton([...removeButtons].filter((removeButton=>removeButton.id.includes("resource"))),"id_remove_resource"))}(null!==decodedParams.sectionId,null!==decodedParams.subQuestionId),(0,_utils.formatEditorAndFileManager)(),(0,_utils.appendSizeToFileManager)(),(0,_accordionHandler.handleAccordions)(!1),(0,_accordionHandler.initAccordionsAfterFillingForm)(),window.$("#udeh-form").prop("action",window.$("#udeh-form").prop("action")+"?id="+decodedParams.sectionId);var courseId,sectionId,subQuestionId,type,toolList};let counterElement=0,counterSubElement=0,element=null,elementName=null,subElementsName=null;function hideShowFreeActivity(freeTypesTextArea,i){let currentContainer=document.getElementById("fitem_id_exploration_activity_free_type_"+i);currentContainer&&("19"!==freeTypesTextArea[i].value?currentContainer.setAttribute("style","display: none !important;"):null!==currentContainer.getAttribute("style")&&currentContainer.removeAttribute("style"))}function disableRemoveButton(buttonList,id){if(1===buttonList.length){document.querySelectorAll('[id^="'+id+'"]').forEach((button=>{"BUTTON"===button.tagName&&(button.hidden=!0)}))}else{document.querySelectorAll('[id^="'+id+'"]').forEach((button=>{"BUTTON"===button.tagName&&(button.hidden=!1)}))}}function changeTag(element,tag){const newElem=document.createElement(tag),clone=element.cloneNode(!0);for(;clone.firstChild;)newElem.appendChild(clone.firstChild);if(clone.attributes)for(let i=0;i<clone.attributes.length;i++)newElem.setAttribute(clone.attributes[i].name,clone.attributes[i].value);return newElem}function updatePreviewHeader(isSubquestion){let headerPreview=document.querySelector('[id*="preview_header"]');headerPreview.firstElementChild.innerHTML=isSubquestion?elementName+" "+(counterElement+1)+"."+(counterSubElement+1)+" - "+(0,_utils.removeTags)(element.title):element.title?elementName+" "+(counterElement+1)+" - "+(0,_utils.removeTags)(element.title):elementName+" "+(counterElement+1)}async function updateCurrentAccordions(subElementName){let accordions=[],valueForAccordion=null,valueForDiv=null,subQName=await(0,_str.get_string)("subquestion","format_udehauthoring"),explorationName=await(0,_str.get_string)("exploration","format_udehauthoring"),resourceName=await(0,_str.get_string)("resource","format_udehauthoring");subElementName===subQName?(accordions=document.querySelectorAll('[class*="row_section_subquestion_container"]'),valueForAccordion="SectionSubQuestion_",valueForDiv="subquestion"):subElementName===resourceName?(accordions=document.querySelectorAll('[class*="row_subquestion_resource_container"]'),valueForAccordion="SubQuestionResource_",valueForDiv="resource"):subElementName===explorationName&&(accordions=document.querySelectorAll('[class*="row_subquestion_exploration_container"]'),valueForAccordion="SubQuestionExploration_",valueForDiv="exploration");for(const[i,accordion]of accordions.entries()){let accordionContainer=accordion.querySelector('[class*="accordion-container"]'),headerLink=accordionContainer.firstElementChild.firstElementChild;headerLink.href="#collapse"+valueForAccordion+i,headerLink.setAttribute("aria-controls","collapse"+valueForAccordion+i),accordionContainer.children[1].setAttribute("id","collapse"+valueForAccordion+i),i>0&&(accordionContainer.children[1].setAttribute("class","collapse"),headerLink.setAttribute("aria-expanded","false"),headerLink.setAttribute("class","collapsed")),subElementName===subQName?await updateAccordionText(headerLink,subElementName+" ",i,element.subquestions):subElementName===resourceName?await updateAccordionText(headerLink,subElementName+" ",i,element.resources):subElementName===explorationName&&await updateAccordionText(headerLink,subElementName+" ",i,element.explorations,!1)}let addContainer=document.getElementById("add_"+valueForDiv+"_container");addContainer.firstElementChild.firstElementChild.innerHTML=subElementName===subQName?subElementName+" "+(counterElement+1)+"."+(accordions.length+1):subElementName+" "+(counterElement+1)+"."+(counterSubElement+1)+"."+(accordions.length+1)}async function updateAccordionText(headerLink,subElementName,counter,array){let hasTitle=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],subQName=await(0,_str.get_string)("subquestion","format_udehauthoring");if(array&&array[counter]){let title=array[counter].title,headerContent="";headerContent=hasTitle?subElementName.trim()===subQName.trim()?subElementName+(counterElement+1)+"."+(counter+1)+" - "+(0,_utils.removeTags)(title):subElementName+(counterElement+1)+"."+(counterSubElement+1)+"."+(counter+1)+" - "+(0,_utils.removeTags)(title):subElementName.trim()===subQName?subElementName+(counterElement+1)+"."+(counter+1):subElementName+(counterElement+1)+"."+(counterSubElement+1)+"."+(counter+1),headerLink.innerHTML=headerContent.length>70?headerContent.substring(0,70)+"...":headerContent}else headerLink.innerHTML=subElementName.trim()===subQName?subElementName+(counterElement+1)+"."+(counter+1):subElementName+(counterElement+1)+"."+(counterSubElement+1)+"."+(counter+1)}}));

//# sourceMappingURL=phpHelper.min.js.map