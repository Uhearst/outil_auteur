define("format_udehauthoring/phpHelper",["exports","./utils","./toolHelper","./language/format_udehauthoring_fr","./validator/sectionValidator"],(function(_exports,_utils,_toolHelper,_format_udehauthoring_fr,_sectionValidator){function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(params){var decodedParams=JSON.parse(params);type=decodedParams.type,0===type?(elementName=_format_udehauthoring_fr.dictionnary.module,subElementsName=[_format_udehauthoring_fr.dictionnary.trame]):(elementName=_format_udehauthoring_fr.dictionnary.trame,subElementsName=[_format_udehauthoring_fr.dictionnary.activity,_format_udehauthoring_fr.dictionnary.resource]),function(courseId,sectionId,subQuestionId,type,toolList){0===type?(window.$.ajax({type:"POST",url:"../handlers/ajax_module_handler.php",data:{courseId:courseId},success:function(response){JSON.parse(response).data.forEach((function(module,i){parseInt(module.id)===sectionId&&(element=module,counterElement=i)})),updatePreviewHeader(!1),subElementsName.forEach((function(subElementName){updateCurrentAccordions(subElementName)}))},error:function(){window.console.log("failure")}}),(0,_sectionValidator.validateSectionForm)(),(0,_utils.handleEmbed)("fitem_id_section_introduction_embed","fitem_id_section_introduction")):(window.$.ajax({type:"POST",url:"../handlers/ajax_subquestion_handler.php",data:{sectionId:sectionId,courseId:courseId},success:function(response){var parsedResponse=JSON.parse(response);parsedResponse.data.forEach((function(subQuestion,i){parseInt(subQuestion.id)===subQuestionId&&(element=subQuestion,counterElement=parsedResponse.sectionIndex,counterSubElement=i)})),updatePreviewHeader(!0),subElementsName.forEach((function(subElementName){updateCurrentAccordions(subElementName)}))},error:function(){window.console.log("failure")}}),(0,_toolHelper.initRedactTools)(1,toolList),function(){for(var freeTypesTextArea=document.querySelectorAll('[name^="exploration_activity_type["]'),_loop=function(i){hideShowFreeActivity(freeTypesTextArea,i),freeTypesTextArea[i].addEventListener("change",(function(){hideShowFreeActivity(freeTypesTextArea,i)}))},i=0;i<freeTypesTextArea.length;i++)_loop(i)}())}(decodedParams.courseId,decodedParams.sectionId,decodedParams.subQuestionId,decodedParams.type,decodedParams.toolList),document.querySelectorAll('[name^="add"]').forEach((function(addButton,i){if("submit"===addButton.getAttribute("type")){var colContainers=document.querySelectorAll(".add_action_button"),icon=document.createElement("i"),updatedButton=changeTag(addButton,"button");updatedButton.setAttribute("class","btn add-button"),icon.setAttribute("class","fa fa-plus-circle fa-2x"),updatedButton.appendChild(icon),colContainers[i].appendChild(updatedButton),addButton.hidden=!0}})),isSectionPage=null!==decodedParams.sectionId,isSubQuestionPage=null!==decodedParams.subQuestionId,removeButtons=document.querySelectorAll('[name^="remove_"]'),removeButtons.forEach((function(removeButton){if("submit"===removeButton.getAttribute("type")){var icon=document.createElement("i"),updatedButton=changeTag(removeButton,"button");updatedButton.setAttribute("class","btn remove-button"),icon.setAttribute("class","fa fa-minus-circle fa-2x"),updatedButton.appendChild(icon),removeButton.parentElement.appendChild(updatedButton),removeButton.parentElement.classList.add("remove_action_button"),removeButton.hidden=!0}})),isSectionPage&&!isSubQuestionPage?disableRemoveButton(_toConsumableArray(removeButtons),"id_remove_section"):isSubQuestionPage&&(disableRemoveButton(_toConsumableArray(removeButtons).filter((function(removeButton){return removeButton.id.includes("exploration")})),"id_remove_exploration"),disableRemoveButton(_toConsumableArray(removeButtons).filter((function(removeButton){return removeButton.id.includes("resource")})),"id_remove_resource")),(0,_utils.formatEditorAndFileManager)(),(0,_utils.getAndSetScrollPosition)(),(0,_utils.appendSizeToFileManager)();var isSectionPage,isSubQuestionPage,removeButtons;var type};var counterElement=0,counterSubElement=0,element=null,elementName=null,subElementsName=null;function hideShowFreeActivity(freeTypesTextArea,i){var currentContainer=document.getElementById("fitem_id_exploration_activity_free_type_"+i);"19"!==freeTypesTextArea[i].value?currentContainer.setAttribute("style","display: none !important;"):null!==currentContainer.getAttribute("style")&&currentContainer.removeAttribute("style")}function disableRemoveButton(buttonList,id){1===buttonList.length?document.querySelectorAll('[id^="'+id+'"]').forEach((function(button){"BUTTON"===button.tagName&&(button.hidden=!0)})):document.querySelectorAll('[id^="'+id+'"]').forEach((function(button){"BUTTON"===button.tagName&&(button.hidden=!1)}))}function changeTag(element,tag){for(var newElem=document.createElement(tag),clone=element.cloneNode(!0);clone.firstChild;)newElem.appendChild(clone.firstChild);if(clone.attributes)for(var i=0;i<clone.attributes.length;i++)newElem.setAttribute(clone.attributes[i].name,clone.attributes[i].value);return newElem}function updatePreviewHeader(isSubquestion){var headerPreview=document.querySelector('[id*="preview_header"]');headerPreview.firstElementChild.innerHTML=isSubquestion?elementName+(counterElement+1)+"."+(counterSubElement+1)+" - "+(0,_utils.removeTags)(element.title):elementName+(counterElement+1)+" - "+(0,_utils.removeTags)(element.title)}function updateCurrentAccordions(subElementName){var accordions=null,valueForAccordion=null,valueForDiv=null;subElementName===_format_udehauthoring_fr.dictionnary.trame?(accordions=document.querySelectorAll('[class*="row_section_subquestion_container"]'),valueForAccordion="SectionSubQuestion_",valueForDiv="subquestion"):subElementName===_format_udehauthoring_fr.dictionnary.resource?(accordions=document.querySelectorAll('[class*="row_subquestion_resource_container"]'),valueForAccordion="SubQuestionResource_",valueForDiv="resource"):subElementName===_format_udehauthoring_fr.dictionnary.activity&&(accordions=document.querySelectorAll('[class*="row_subquestion_exploration_container"]'),valueForAccordion="SubQuestionExploration_",valueForDiv="exploration"),accordions.forEach((function(accordion,i){var accordionContainer=accordion.querySelector('[class*="accordion-container"]'),headerLink=accordionContainer.firstElementChild.firstElementChild;headerLink.href="#collapse"+valueForAccordion+i,headerLink.setAttribute("aria-controls","collapse"+valueForAccordion+i),accordionContainer.children[1].setAttribute("id","collapse"+valueForAccordion+i),i>0&&(accordionContainer.children[1].setAttribute("class","collapse"),headerLink.setAttribute("aria-expanded","false"),headerLink.setAttribute("class","collapsed")),subElementName===_format_udehauthoring_fr.dictionnary.trame?updateAccordionText(headerLink,subElementName,i,element.subquestions):subElementName===_format_udehauthoring_fr.dictionnary.resource?updateAccordionText(headerLink,subElementName,i,element.resources):subElementName===_format_udehauthoring_fr.dictionnary.activity&&updateAccordionText(headerLink,subElementName,i,element.explorations,!1)}));var addContainer=document.getElementById("add_"+valueForDiv+"_container");subElementName===_format_udehauthoring_fr.dictionnary.trame?addContainer.firstElementChild.firstElementChild.innerHTML=subElementName+" "+(counterElement+1)+"."+(accordions.length+1):addContainer.firstElementChild.firstElementChild.innerHTML=subElementName+" "+(counterElement+1)+"."+(counterSubElement+1)+"."+(accordions.length+1)}function updateAccordionText(headerLink,subElementName,counter,array){var hasTitle=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(array&&array[counter]){var title=array[counter].title,headerContent="";headerContent=hasTitle?subElementName===_format_udehauthoring_fr.dictionnary.trame?subElementName+(counterElement+1)+"."+(counter+1)+" - "+(0,_utils.removeTags)(title):subElementName+(counterElement+1)+"."+(counterSubElement+1)+"."+(counter+1)+" - "+(0,_utils.removeTags)(title):subElementName===_format_udehauthoring_fr.dictionnary.trame?subElementName+(counterElement+1)+"."+(counter+1):subElementName+(counterElement+1)+"."+(counterSubElement+1)+"."+(counter+1),headerLink.innerHTML=headerContent.length>70?headerContent.substring(0,70)+"...":headerContent}else headerLink.innerHTML=subElementName===_format_udehauthoring_fr.dictionnary.trame?subElementName+(counterElement+1)+"."+(counter+1):subElementName+(counterElement+1)+"."+(counterSubElement+1)+"."+(counter+1)}}));

//# sourceMappingURL=phpHelper.min.js.map