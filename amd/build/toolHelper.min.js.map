{"version":3,"file":"toolHelper.min.js","sources":["../src/toolHelper.js"],"sourcesContent":["import * as Str from 'core/str';\nimport {addNotification} from \"./notificationHelper\";\n\n/**\n * @param {array} params\n */\nexport function initEditTools(params) {\n    let form = document.querySelector('[action^=\"modedit.php\"]');\n    form.action = \"udeh_modedit.php\";\n    let subquestionIdInput = document.createElement('input');\n    subquestionIdInput.name = 'subquestionid';\n    subquestionIdInput.type = 'hidden';\n    subquestionIdInput.value = params[0];\n    let explorationIdInput = document.createElement('input');\n    explorationIdInput.name = 'explorationid';\n    explorationIdInput.type = 'hidden';\n    explorationIdInput.value = params[1];\n    let evaluationIdInput = document.createElement('input');\n    evaluationIdInput.name = 'evaluationid';\n    evaluationIdInput.type = 'hidden';\n    evaluationIdInput.value = params[2];\n    let isglobalInput = document.createElement('input');\n    isglobalInput.name = 'isglobal';\n    isglobalInput.type = 'hidden';\n    isglobalInput.value = params[3];\n    form.firstElementChild.appendChild(subquestionIdInput);\n    form.firstElementChild.appendChild(explorationIdInput);\n    form.firstElementChild.appendChild(evaluationIdInput);\n    form.firstElementChild.appendChild(isglobalInput);\n    let buttonarr = document.getElementById('fgroup_id_buttonar');\n    if (buttonarr === null) {\n        window.console.error('Back button to redact couldn\\'t be appended. Contact a programmer.');\n    } else {\n        let buttonsContainer = buttonarr.children[1].children[0].children[0];\n        let newButton = buttonsContainer.children[1].cloneNode(true);\n        newButton.children[0].children[0].name = 'submitbutton3';\n        newButton.children[0].children[0].id = 'id_submitbutton3';\n        var strings = [\n            {\n                key: 'saveandreturntoredact',\n                component: 'format_udehauthoring'\n            },\n        ];\n        Str.get_strings(strings).then(function(results) {\n            if (results === [] || results === null) {\n                newButton.children[0].children[0].value = 'Enregistrer et retourner à la rédaction';\n            } else {\n                newButton.children[0].children[0].value = results[0];\n            }\n        });\n\n        newButton.children[1].id = 'id_error_submitbutton3';\n        buttonsContainer.insertBefore(newButton, buttonsContainer.children[2]);\n    }\n}\n\n/**\n * @param {int} type\n * @param {array} toolList\n */\nexport function initRedactTools(type, toolList) {\n    if (type === 1) {\n        appendExplorationLinkToRedactForm(toolList);\n    } else if (type === 2) {\n        appendEvaluationLinkToRedactForm(toolList);\n    }\n    appendDataToSubmit();\n}\n\n/**\n *\n */\nfunction appendDataToSubmit() {\n    let inputToAppend = document.createElement('input');\n    document.getElementById('udeh-form').addEventListener(\"submit\", function(e) {\n        if (e.submitter && e.submitter.name.includes('generate_tool')) {\n            e.preventDefault();\n            let n = window.location.pathname.lastIndexOf('/');\n            let page = window.location.pathname.substring(n + 1);\n            if (page.includes('subquestion')) {\n                let index = e.submitter.name.substring(\n                    e.submitter.name.indexOf('[') + 1,\n                    e.submitter.name.indexOf(']')\n                );\n                let explorationIdHolder = document.querySelector('[name=\"exploration_id[' + index + ']\"]');\n                if (explorationIdHolder === null || explorationIdHolder.value === \"0\") {\n                    addNotification('Vous devez enregistré l\\'exploration avant d\\'y associer un outil', 2);\n                    return;\n                }\n            }\n            inputToAppend.type = 'hidden';\n            inputToAppend.name = e.submitter.name;\n            inputToAppend.value = 'Generate Tool';\n            window.$('#udeh-form')[0].append(inputToAppend);\n            window.$('#udeh-form').submit();\n        }\n    });\n}\n\n/**\n * @param {array} toolList\n */\nfunction appendEvaluationLinkToRedactForm(toolList) {\n    let evaluationToolsLink = document.querySelectorAll('[name^=\"evaluation_tool_cmid\"]');\n    if (location.href.includes('globalevaluation')) {\n        appendMultipleEvaluationLinkToRedactForm(evaluationToolsLink, toolList);\n    } else {\n        appendSingleEvaluationLinkToRedactForm(toolList[0]);\n    }\n}\n\n/**\n * @param {string} evalName\n */\nfunction appendSingleEvaluationLinkToRedactForm(evalName) {\n    let evaluationToolLink = document.querySelector('[name^=\"evaluation_tool_cmid\"]');\n\n    let urlDisplayer = document.getElementById('fgroup_id_url_group');\n\n    let evaluationId = null;\n    let evaluationIdHolder = document.querySelector('[name=\"id\"]');\n    if (evaluationToolLink.value === null\n        || evaluationToolLink.value === '') {\n        urlDisplayer.style = \"display:none;\";\n        return;\n    } else {\n        let currentButton = document.getElementById('id_generate_tool');\n        currentButton.disabled = true;\n        let select = document.getElementById('id_evaluation_tool');\n        select.disabled = true;\n        evaluationId = evaluationIdHolder.value;\n    }\n\n    let container = document.createElement('div');\n    container.setAttribute('class', 'form-group fitem');\n    let linkContainer = document.createElement('a');\n    let url = window.location.href.substring(0, window.location.href.indexOf('redact'));\n    url = url + 'udeh_modedit.php?update=' + evaluationToolLink.value + '&return=0&sr0=&evaluationid='\n        + evaluationId;\n    linkContainer.setAttribute('href', url);\n    linkContainer.setAttribute('id', 'evaluation_tool_name');\n    linkContainer.innerHTML = evalName;\n    container.appendChild(linkContainer);\n\n    urlDisplayer.children[1].children[0].children[1].insertBefore(\n        container, urlDisplayer.children[1].children[0].children[1].firstElementChild);\n\n}\n\n/**\n * @param {array} evaluationToolsLink\n * @param {array} toolList\n */\nfunction appendMultipleEvaluationLinkToRedactForm(evaluationToolsLink, toolList) {\n    evaluationToolsLink.forEach(evaluationToolLink => {\n        let toolIndex = evaluationToolLink.name.slice(evaluationToolLink.name.indexOf('[') + 1,\n            evaluationToolLink.name.lastIndexOf(']'));\n        let urlDisplayer = document.getElementById('fgroup_id_url_group_' + toolIndex);\n\n        let evaluationId = null;\n        let evaluationIdHolder = document.querySelector('[name=\"evaluation_id[' + toolIndex + ']\"]');\n        if (evaluationToolLink.value === null\n            || evaluationToolLink.value === '') {\n            urlDisplayer.style = \"display:none;\";\n            return;\n        } else {\n            let currentButton = document.getElementById('id_tool_group_' + toolIndex + '_generate_tool');\n            currentButton.disabled = true;\n            let select = document.getElementById('id_tool_group_' + toolIndex + '_evaluation_tool');\n            select.disabled = true;\n            evaluationId = evaluationIdHolder.value;\n        }\n\n        let container = document.createElement('div');\n        container.setAttribute('class', 'form-group fitem');\n        let linkContainer = document.createElement('a');\n        let url = window.location.href.substring(0, window.location.href.indexOf('redact'));\n        url = url + 'udeh_modedit.php?update=' + evaluationToolLink.value + '&return=0&sr0=&evaluationid='\n            + evaluationId + '&isglobal=1';\n        linkContainer.setAttribute('href', url);\n        linkContainer.setAttribute('id', 'evaluation_tool_name_' + toolIndex);\n        linkContainer.innerHTML = toolList[toolIndex];\n        container.appendChild(linkContainer);\n\n        urlDisplayer.children[1].children[0].children[1].insertBefore(\n            container, urlDisplayer.children[1].children[0].children[1].firstElementChild);\n    });\n}\n\n/**\n * @param {array} toolList\n */\nfunction appendExplorationLinkToRedactForm(toolList) {\n    let explorationToolsLink = document.querySelectorAll('[name^=\"exploration_tool_cmid[\"]');\n    explorationToolsLink.forEach(explorationToolLink => {\n        let toolIndex = explorationToolLink.name.slice(explorationToolLink.name.indexOf('[') + 1,\n            explorationToolLink.name.lastIndexOf(']'));\n        let urlDisplayer = document.getElementById('fgroup_id_url_group_' + toolIndex);\n\n        let subquestionId = null;\n        if (window.location.href.indexOf('=') === -1) {\n            subquestionId = 0;\n        } else {\n            subquestionId = window.location.href.substring(window.location.href.indexOf('=') + 1);\n        }\n        let explorationId = null;\n        let explorationIdHolder = document.querySelector('[name=\"exploration_id[' + toolIndex + ']\"]');\n        if (explorationIdHolder === null\n            || explorationIdHolder.value === \"0\"\n            || explorationToolLink.value === null\n            || explorationToolLink.value === '') {\n            urlDisplayer.style = \"display:none;\";\n            return;\n        } else {\n            let currentButton = document.getElementById('id_tool_group_' + toolIndex + '_generate_tool');\n            currentButton.disabled = true;\n            let select = document.getElementById('id_tool_group_' + toolIndex + '_exploration_tool');\n            select.disabled = true;\n            explorationId = explorationIdHolder.value;\n        }\n\n        let container = document.createElement('div');\n        container.setAttribute('class', 'form-group fitem');\n        let linkContainer = document.createElement('a');\n        let url = window.location.href.substring(0, window.location.href.indexOf('redact'));\n        url = url + 'udeh_modedit.php?update=' + explorationToolLink.value + '&return=0&sr0=&subquestionid='\n            + subquestionId + '&explorationid=' + explorationId;\n        linkContainer.setAttribute('href', url);\n        linkContainer.setAttribute('id', 'exploration_tool_name_' + toolIndex);\n        linkContainer.innerHTML = toolList[toolIndex];\n        container.appendChild(linkContainer);\n\n        urlDisplayer.children[1].children[0].children[1].insertBefore(\n            container, urlDisplayer.children[1].children[0].children[1].firstElementChild);\n    });\n}"],"names":["params","form","document","querySelector","action","subquestionIdInput","createElement","name","type","value","explorationIdInput","evaluationIdInput","isglobalInput","firstElementChild","appendChild","buttonarr","getElementById","window","console","error","buttonsContainer","children","newButton","cloneNode","id","Str","get_strings","key","component","then","results","insertBefore","toolList","querySelectorAll","forEach","explorationToolLink","toolIndex","slice","indexOf","lastIndexOf","urlDisplayer","subquestionId","location","href","substring","explorationId","explorationIdHolder","disabled","container","setAttribute","linkContainer","url","innerHTML","style","appendExplorationLinkToRedactForm","evaluationToolsLink","includes","evaluationToolLink","evaluationId","evaluationIdHolder","appendMultipleEvaluationLinkToRedactForm","evalName","appendSingleEvaluationLinkToRedactForm","appendEvaluationLinkToRedactForm","inputToAppend","addEventListener","e","submitter","preventDefault","n","pathname","index","$","append","submit"],"mappings":"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"}