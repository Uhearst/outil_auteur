{"version":3,"file":"toolHelper.min.js","sources":["../src/toolHelper.js"],"sourcesContent":["import {get_string as getString} from 'core/str';\nimport {addNotification} from \"./notificationHelper\";\n\n/**\n * @param {array} params\n */\nexport function initEditTools(params) {\n    let form = document.querySelector('[action^=\"modedit.php\"]');\n    form.action = \"udeh_modedit.php\";\n    let subquestionIdInput = document.createElement('input');\n    subquestionIdInput.name = 'subquestionid';\n    subquestionIdInput.type = 'hidden';\n    subquestionIdInput.value = params[0];\n    let explorationIdInput = document.createElement('input');\n    explorationIdInput.name = 'explorationid';\n    explorationIdInput.type = 'hidden';\n    explorationIdInput.value = params[1];\n    let evaluationIdInput = document.createElement('input');\n    evaluationIdInput.name = 'evaluationid';\n    evaluationIdInput.type = 'hidden';\n    evaluationIdInput.value = params[2];\n    let isglobalInput = document.createElement('input');\n    isglobalInput.name = 'isglobal';\n    isglobalInput.type = 'hidden';\n    isglobalInput.value = params[3];\n    form.firstElementChild.appendChild(subquestionIdInput);\n    form.firstElementChild.appendChild(explorationIdInput);\n    form.firstElementChild.appendChild(evaluationIdInput);\n    form.firstElementChild.appendChild(isglobalInput);\n    let buttonarr = document.getElementById('fgroup_id_buttonar');\n    if (buttonarr === null) {\n        window.console.error('Back button to redact couldn\\'t be appended. Contact a programmer.');\n    } else {\n        let buttonsContainer = buttonarr.children[1].children[0].children[0];\n        let newButton = buttonsContainer.children[1].cloneNode(true);\n        newButton.children[0].children[0].name = 'submitbutton3';\n        newButton.children[0].children[0].id = 'id_submitbutton3';\n\n        getString('saveandreturntoredact', 'format_udehauthoring')\n            .then(\n                (valueString) => {\n                    newButton.children[0].children[0].value = valueString;\n                }\n            )\n            .catch(() => {\n                newButton.children[0].children[0].value = 'Enregistrer et retourner à la rédaction';\n            });\n\n        newButton.children[1].id = 'id_error_submitbutton3';\n        buttonsContainer.insertBefore(newButton, buttonsContainer.children[2]);\n    }\n}\n\n/**\n * @param {int} type\n * @param {array} toolList\n */\nexport function initRedactTools(type, toolList) {\n    if (type === 1) {\n        appendExplorationLinkToRedactForm(toolList);\n    } else if (type === 2) {\n        appendEvaluationLinkToRedactForm(toolList);\n    }\n    appendDataToSubmit();\n}\n\n/**\n *\n */\nfunction appendDataToSubmit() {\n    let inputToAppend = document.createElement('input');\n    document.getElementById('udeh-form').addEventListener(\"submit\", async function(e) {\n        if (e.submitter && e.submitter.name.includes('generate_tool')) {\n            e.preventDefault();\n            let n = window.location.pathname.lastIndexOf('/');\n            let page = window.location.pathname.substring(n + 1);\n            if (page.includes('subquestion')) {\n                let index = e.submitter.name.substring(\n                    e.submitter.name.indexOf('[') + 1,\n                    e.submitter.name.indexOf(']')\n                );\n                let explorationIdHolder = document.querySelector('[name=\"exploration_id[' + index + ']\"]');\n\n                if (explorationIdHolder === null || explorationIdHolder.value === \"0\") {\n                    addNotification(await getString('notificationerrorsaveexplo', 'format_udehauthoring'), 2);\n                    return;\n                }\n            }\n            inputToAppend.type = 'hidden';\n            inputToAppend.name = e.submitter.name;\n            inputToAppend.value = 'Generate Tool';\n            window.$('#udeh-form')[0].append(inputToAppend);\n            window.$('#udeh-form').submit();\n        }\n    });\n}\n\n/**\n * @param {array} toolList\n */\nfunction appendEvaluationLinkToRedactForm(toolList) {\n    let evaluationToolsLink = document.querySelectorAll('[name^=\"evaluation_tool_cmid\"]');\n    if (location.href.includes('globalevaluation')) {\n        appendMultipleEvaluationLinkToRedactForm(evaluationToolsLink, toolList);\n    } else {\n        appendSingleEvaluationLinkToRedactForm(toolList[0]);\n    }\n}\n\n/**\n * @param {string} evalName\n */\nfunction appendSingleEvaluationLinkToRedactForm(evalName) {\n    let evaluationToolLink = document.querySelector('[name^=\"evaluation_tool_cmid\"]');\n\n    let urlDisplayer = document.getElementById('fgroup_id_url_group');\n\n    let evaluationId = null;\n    let evaluationIdHolder = document.querySelector('[name=\"id\"]');\n    if (evaluationToolLink.value === null\n        || evaluationToolLink.value === ''\n        || evalName === '') {\n        urlDisplayer.style = \"display:none;\";\n        return;\n    } else {\n        let currentButton = document.getElementById('id_generate_tool');\n        currentButton.disabled = true;\n        let select = document.getElementById('id_evaluation_tool');\n        select.disabled = true;\n        evaluationId = evaluationIdHolder.value;\n    }\n\n    let container = document.createElement('div');\n    container.setAttribute('class', 'form-group fitem');\n    let linkContainer = document.createElement('a');\n    let url = window.location.href.substring(0, window.location.href.indexOf('redact'));\n    url = url + 'udeh_modedit.php?update=' + evaluationToolLink.value + '&return=0&sr0=&evaluationid='\n        + evaluationId;\n    linkContainer.setAttribute('href', url);\n    linkContainer.setAttribute('id', 'evaluation_tool_name');\n    linkContainer.innerHTML = evalName;\n    container.appendChild(linkContainer);\n\n    urlDisplayer.children[1].children[0].children[1].insertBefore(\n        container, urlDisplayer.children[1].children[0].children[1].firstElementChild);\n\n}\n\n/**\n * @param {array} evaluationToolsLink\n * @param {array} toolList\n */\nfunction appendMultipleEvaluationLinkToRedactForm(evaluationToolsLink, toolList) {\n    evaluationToolsLink.forEach(evaluationToolLink => {\n        let toolIndex = evaluationToolLink.name.slice(evaluationToolLink.name.indexOf('[') + 1,\n            evaluationToolLink.name.lastIndexOf(']'));\n        let urlDisplayer = document.getElementById('fgroup_id_url_group_' + toolIndex);\n\n        let evaluationId = null;\n        let evaluationIdHolder = document.querySelector('[name=\"evaluation_id[' + toolIndex + ']\"]');\n        if (evaluationToolLink.value === null\n            || evaluationToolLink.value === ''\n            || toolList[toolIndex] === '') {\n            urlDisplayer.style = \"display:none;\";\n            return;\n        } else {\n            let currentButton = document.getElementById('id_tool_group_' + toolIndex + '_generate_tool');\n            currentButton.disabled = true;\n            let select = document.getElementById('id_tool_group_' + toolIndex + '_evaluation_tool');\n            select.disabled = true;\n            evaluationId = evaluationIdHolder.value;\n        }\n\n        let container = document.createElement('div');\n        container.setAttribute('class', 'form-group fitem');\n        let linkContainer = document.createElement('a');\n        let url = window.location.href.substring(0, window.location.href.indexOf('redact'));\n        url = url + 'udeh_modedit.php?update=' + evaluationToolLink.value + '&return=0&sr0=&evaluationid='\n            + evaluationId + '&isglobal=1';\n        linkContainer.setAttribute('href', url);\n        linkContainer.setAttribute('id', 'evaluation_tool_name_' + toolIndex);\n        linkContainer.innerHTML = toolList[toolIndex];\n        container.appendChild(linkContainer);\n\n        urlDisplayer.children[1].children[0].children[1].insertBefore(\n            container, urlDisplayer.children[1].children[0].children[1].firstElementChild);\n    });\n}\n\n/**\n * @param {array} toolList\n */\nfunction appendExplorationLinkToRedactForm(toolList) {\n    let explorationToolsLink = document.querySelectorAll('[name^=\"exploration_tool_cmid[\"]');\n    explorationToolsLink.forEach(explorationToolLink => {\n\n        let toolIndex = explorationToolLink.name.slice(explorationToolLink.name.indexOf('[') + 1,\n            explorationToolLink.name.lastIndexOf(']'));\n        let urlDisplayer = document.getElementById('fgroup_id_url_group_' + toolIndex);\n\n        if (toolList[toolIndex] === '' || toolList[toolIndex] === null || toolList[toolIndex] === undefined) {\n            urlDisplayer.style = \"display:none;\";\n            return;\n        }\n        let subquestionId = null;\n        if (window.location.href.indexOf('=') === -1) {\n            subquestionId = 0;\n        } else {\n            subquestionId = window.location.href.substring(window.location.href.indexOf('=') + 1);\n        }\n        let explorationId = null;\n\n        let explorationIdHolder = document.querySelector('[name=\"exploration_id[' + toolIndex + ']\"]');\n        if (explorationIdHolder === null\n            || explorationIdHolder.value === \"0\"\n            || explorationToolLink.value === null\n            || explorationToolLink.value === '') {\n            urlDisplayer.style = \"display:none;\";\n            return;\n        } else {\n            let currentButton = document.getElementById('id_tool_group_' + toolIndex + '_generate_tool');\n            currentButton.disabled = true;\n            let select = document.getElementById('id_tool_group_' + toolIndex + '_exploration_tool');\n            select.disabled = true;\n            explorationId = explorationIdHolder.value;\n        }\n        let container = document.createElement('div');\n        container.setAttribute('class', 'form-group fitem');\n        let linkContainer = document.createElement('a');\n        let url = window.location.href.substring(0, window.location.href.indexOf('redact'));\n        url = url + 'udeh_modedit.php?update=' + explorationToolLink.value + '&return=0&sr0=&subquestionid='\n            + subquestionId + '&explorationid=' + explorationId;\n        linkContainer.setAttribute('href', url);\n        linkContainer.setAttribute('id', 'exploration_tool_name_' + toolIndex);\n        linkContainer.innerHTML = toolList[toolIndex];\n        container.appendChild(linkContainer);\n        urlDisplayer.children[1].children[0].children[1].insertBefore(\n            container, urlDisplayer.children[1].children[0].children[1].firstElementChild);\n    });\n}"],"names":["params","form","document","querySelector","action","subquestionIdInput","createElement","name","type","value","explorationIdInput","evaluationIdInput","isglobalInput","firstElementChild","appendChild","buttonarr","getElementById","window","console","error","buttonsContainer","children","newButton","cloneNode","id","then","valueString","catch","insertBefore","toolList","querySelectorAll","forEach","explorationToolLink","toolIndex","slice","indexOf","lastIndexOf","urlDisplayer","undefined","style","subquestionId","location","href","substring","explorationId","explorationIdHolder","disabled","container","setAttribute","linkContainer","url","innerHTML","appendExplorationLinkToRedactForm","evaluationToolsLink","includes","evaluationToolLink","evaluationId","evaluationIdHolder","appendMultipleEvaluationLinkToRedactForm","evalName","appendSingleEvaluationLinkToRedactForm","appendEvaluationLinkToRedactForm","inputToAppend","addEventListener","async","e","submitter","preventDefault","n","pathname","index","$","append","submit","appendDataToSubmit"],"mappings":"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"}