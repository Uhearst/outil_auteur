{"version":3,"file":"utils.min.js","sources":["../src/utils.js"],"sourcesContent":["import {dictionnary} from \"./language/format_udehauthoring_fr\";\n\nlet tryCounter = 0;\n\n/**\n * @param {string} id\n * @param {string} toolBarOptions\n */\nexport function initTinyMce(id, toolBarOptions) {\n    window.tinymce.init({\n        selector: 'textarea#' + id,\n        menubar: false,\n        plugins: 'lists image table link charmap emoticons',\n        toolbar: toolBarOptions,\n        branding: false,\n        min_height: 160,\n        height: 160\n    });\n}\n\n/**\n * @param {string} id\n */\nexport function removeTinyMce(id) {\n    window.tinymce.remove('#' + id);\n}\n\n/**\n * @param {String} str\n */\nexport function removeTags(str) {\n    if ((str === null) || (str === '')) {\n        return false;\n    } else {\n        str = str.toString();\n    }\n\n    return str.replace(/(<([^>]+)>)/ig, '');\n}\n\n/**\n * @param {Array} buttons\n */\nexport function prepareActionButton(buttons) {\n    let addingButtonsContainer = document.\n    querySelectorAll(\"[class='col-md-9 form-inline align-items-start felement']\");\n    if (addingButtonsContainer) {\n        addingButtonsContainer.forEach(function(addingButtonContainer) {\n            if (addingButtonContainer.dataset.fieldtype === 'button') {\n                addingButtonContainer.removeAttribute('class');\n                let childNodes = addingButtonContainer.childNodes;\n                childNodes.forEach(child => {\n                    if (child.type && child.type === 'button') {\n                        child.classList.remove('btn-secondary');\n                    }\n                });\n            }\n\n        });\n    }\n    let addingButtons = document.querySelectorAll(\"[class*='add_action_button']\");\n    if (addingButtons) {\n        addingButtons.forEach(function(addingButton) {\n            let childNodes = addingButton.childNodes;\n            childNodes.forEach(child => {\n                child.removeAttribute('class');\n            });\n        });\n    }\n\n    buttons.forEach(button => {\n        if (button.type === 0) {\n            let initialRemoveButton = document.getElementById('fitem_id_remove_' + button.id);\n            if (initialRemoveButton) {\n                initialRemoveButton.firstElementChild.style.setProperty(\"display\", \"none\", \"important\");\n            }\n        } else {\n            let initialRemoveButton = document.getElementById('fitem_id_add_' + button.id);\n            if (initialRemoveButton) {\n                initialRemoveButton.firstElementChild.style.setProperty(\"display\", \"none\", \"important\");\n            }\n        }\n    });\n}\n\n/**\n * @param {string} currentIdContainer\n * @param {int} isObj\n */\nexport function prepareAccordions(currentIdContainer, isObj = 0) {\n    let elements = null;\n    if (isObj === 1) {\n        elements = document.querySelectorAll('[class=\"row row-container mb-3\"]');\n    } else if (isObj === 2) {\n        elements = document.querySelectorAll('[class=\"row row-container-child mb-3\"]');\n    } else {\n        elements = document.querySelectorAll('[id^=' + currentIdContainer + ']');\n    }\n    elements.forEach(element => {\n        window.$(document).ready(function() {\n            window.$('#' + element.firstElementChild.children[1].id).on('shown.bs.collapse', function(event) {\n                event.stopPropagation();\n                let $card = window.$(this).closest('.card');\n                window.$('html,body').animate({\n                    scrollTop: $card.offset().top - 100\n                }, 250);\n            });\n        });\n    });\n}\n\n/**\n * @param {Object} element\n */\nexport function handleNewAccordionElement(element) {\n    tryCounter = tryCounter + 1;\n    window.$(document).ready(function() {\n        let collapsibleId = element.firstElementChild.children[1].getAttribute('id');\n        try {\n            window.$('#' + collapsibleId).collapse('toggle');\n            window.$('#' + collapsibleId).on('shown.bs.collapse', function() {\n                let $card = window.$(this).closest('.card');\n                window.$('html,body').animate({\n                    scrollTop: $card.offset().top - 100\n                }, 250);\n            });\n        } catch (e) {\n            if (tryCounter > 20) {\n                window.console.error('New accordeons can\\'t be handled, contact a dev.');\n                window.console.error('Error detail: ' + e);\n            } else {\n                window.console.log('got error handling new accordeon, will retry');\n                let interval = setInterval(function() {\n                    handleNewAccordionElement(element);\n                    clearInterval(interval);\n                }, 100);\n            }\n        }\n    });\n}\n\n/**\n *\n */\nexport function formatEditorAndFileManager() {\n    let formContainer = document.getElementById('udeh-form');\n    let inputs = formContainer.querySelectorAll('[class^=\"form-group row  fitem   \"]');\n    inputs.forEach(input => {\n        if (input.children[1] && input.children[1].dataset\n            && (input.children[1].dataset.fieldtype === 'editor' || input.children[1].dataset.fieldtype === 'filemanager')) {\n            input.classList.add('inline-element');\n            input.children[1].classList.add('inline-inner-element');\n        }\n    });\n}\n\n\n/**\n * @param {String} anchor\n */\nexport function appendAnchorToForm(anchor) {\n    let anchorInput = document.getElementById('anchor');\n    if (anchorInput === null) {\n        var input = document.createElement(\"input\");\n        input.setAttribute(\"type\", \"hidden\");\n        input.setAttribute(\"name\", \"anchor\");\n        input.setAttribute(\"id\", \"anchor\");\n        input.setAttribute(\"value\", anchor);\n        const formContainer = document.getElementById('form_container');\n        formContainer.appendChild(input);\n    } else {\n        anchorInput.setAttribute('value', anchor);\n    }\n}\n\n/**\n *\n */\nexport function getAndSetScrollPosition() {\n    let addedType = localStorage.getItem(\"added-type\");\n    if (addedType !== null && addedType !== 'null' && addedType !== undefined) {\n        if (document.readyState !== 'loading') {\n            toggleAccordionFromPhpAddition(addedType);\n        } else {\n            document.addEventListener('DOMContentLoaded', function() {\n                toggleAccordionFromPhpAddition(addedType);\n            });\n        }\n    }\n\n    window.addEventListener(\"beforeunload\", () => {\n        if (document.activeElement && document.activeElement.classList && document.activeElement.classList.contains('add-button')) {\n            localStorage.setItem(\"added-type\", document.activeElement.name.substring(document.activeElement.name.indexOf('_' + 1)));\n        } else {\n            localStorage.setItem(\"added-type\", null);\n        }\n    });\n}\n\n/**\n * @param {string} addedType\n */\nfunction toggleAccordionFromPhpAddition(addedType) {\n    let container = null;\n    let rows = null;\n    let forId = null;\n    if (addedType.includes('subquestion')) {\n        container = document.getElementById('section-subquestions-container');\n    } else {\n        forId = addedType.includes('resource') ? 'resources' : 'explorations';\n        container = document.getElementById('subquestion-' + forId + '-container');\n    }\n    rows = container.querySelectorAll('[class*=\"row-container\"]');\n    waitForAccordionIdWithInterval(rows[rows.length - 1]);\n}\n\n/**\n * @param {object} currentElement\n */\nfunction waitForAccordionIdWithInterval(currentElement) {\n    let elementId = null;\n    let interval = setInterval(function() {\n        elementId = currentElement.firstElementChild.children[1].getAttribute('id');\n        if (elementId.includes('_')) {\n            handleNewAccordionElement(currentElement);\n            clearInterval(interval);\n        }\n    }, 100);\n}\n\n/**\n * @param {String} id\n */\nexport function appendStyleToAnchorMenuSection(id) {\n    let container = document.getElementById('collapse-course-container');\n    for (let i = 0; i < container.children.length; i++) {\n        if (!(container.children[i].getAttribute('class').includes('disabled-menu-element'))) {\n            container.children[i].setAttribute('class', 'mb-3');\n            updateIcon(container.children[i], 'actif', 'passif');\n        }\n    }\n    let element = document.getElementById(id);\n    element.classList.add('active-menu-element');\n    updateIcon(element, 'passif', 'actif', true);\n}\n\n/**\n * @param {Object} element\n * @param {String} previousValue\n * @param {String} newValue\n * @param {Boolean} isActive\n */\nfunction updateIcon(element, previousValue, newValue, isActive = false) {\n    let src = element.firstElementChild.firstElementChild.getAttribute('src');\n    if (src && src.includes(previousValue)) {\n        let newSrc = src.replace(previousValue, newValue);\n        element.firstElementChild.firstElementChild.setAttribute('src', newSrc);\n        element.setAttribute('onmouseout', 'this.firstElementChild.firstElementChild.setAttribute(\"src\", \"' + newSrc + '\")');\n    }\n    if (isActive) {\n        element.firstElementChild.setAttribute('class', 'active');\n    } else {\n        element.firstElementChild.removeAttribute('class');\n    }\n}\n\n/**\n *\n */\nexport function appendSizeToFileManager() {\n    let fileManagers = document.querySelectorAll('[id*=\"vignette\"]');\n    if (fileManagers) {\n        fileManagers.forEach(fileManager => {\n            if (fileManager.classList.contains('form-group')) {\n                let valueForFormat = '';\n                if (fileManager.getAttribute('id').includes('resource')) {\n                    valueForFormat = '125 x 80';\n                } else {\n                    valueForFormat = '364 x 215';\n                }\n                let restrictions = fileManager.querySelector('.fp-restrictions');\n                restrictions.firstElementChild.innerHTML =\n                    restrictions.firstElementChild.innerHTML + ', ' + dictionnary.recommendedFormat + valueForFormat;\n            }\n        });\n    }\n}\n\n/**\n * @param {string} embedContainerId\n * @param {string} introductionContainerId\n * @param {Integer} i\n */\nexport function handleEmbed(embedContainerId, introductionContainerId, i = null) {\n\n    let customCheckbox = null;\n    let embedValContainer = null;\n    if (i !== null) {\n        customCheckbox = document.getElementById(('embed_selector_' + i));\n        embedValContainer = document.querySelector('[name=\"isembed[' + i + ']\"]');\n    } else {\n        customCheckbox = document.getElementById('embed_selector');\n        embedValContainer = document.querySelector('[name=\"isembed\"]');\n    }\n    if (embedValContainer.value === \"1\") {\n        customCheckbox.checked = true;\n    }\n    setEmbedVisible(customCheckbox, embedContainerId, introductionContainerId);\n\n    customCheckbox.addEventListener('click', function() {\n        setEmbedVisible(customCheckbox, embedContainerId, introductionContainerId);\n    });\n}\n\n/**\n * @param {object} customCheckbox\n * @param {string} embedContainerId\n * @param {string} introductionContainerId\n */\nfunction setEmbedVisible(customCheckbox, embedContainerId, introductionContainerId) {\n    let embedContainer = document.getElementById(embedContainerId);\n    let introductionContainer = document.getElementById(introductionContainerId);\n    if (customCheckbox.checked) {\n        embedContainer.style = '';\n        introductionContainer.style = 'display:none !important';\n    } else {\n        embedContainer.style = 'display:none !important';\n        introductionContainer.style = '';\n    }\n}"],"names":["anchor","anchorInput","document","getElementById","input","createElement","setAttribute","appendChild","fileManagers","querySelectorAll","forEach","fileManager","classList","contains","valueForFormat","getAttribute","includes","restrictions","querySelector","firstElementChild","innerHTML","dictionnary","recommendedFormat","id","container","i","children","length","updateIcon","element","add","dataset","fieldtype","addedType","localStorage","getItem","undefined","readyState","toggleAccordionFromPhpAddition","addEventListener","window","activeElement","setItem","name","substring","indexOf","embedContainerId","introductionContainerId","customCheckbox","embedValContainer","value","checked","setEmbedVisible","toolBarOptions","tinymce","init","selector","menubar","plugins","toolbar","branding","min_height","height","currentIdContainer","isObj","elements","$","ready","on","event","stopPropagation","$card","this","closest","animate","scrollTop","offset","top","buttons","addingButtonsContainer","addingButtonContainer","removeAttribute","childNodes","child","type","remove","addingButtons","addingButton","button","initialRemoveButton","style","setProperty","str","toString","replace","tryCounter","handleNewAccordionElement","collapsibleId","collapse","e","console","error","log","interval","setInterval","clearInterval","rows","currentElement","forId","previousValue","newValue","isActive","src","newSrc","embedContainer","introductionContainer"],"mappings":"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"}