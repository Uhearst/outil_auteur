define("format_udehauthoring/evaluationHelper",["exports","./utils","./validator/evaluationValidator","./toolHelper","core/str","./accordionHandler"],(function(_exports,_utils,_evaluationValidator,_toolHelper,_str,_accordionHandler){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fillFormEvaluations=async function(evaluations,objList){!function(objList){learningObjectives=[],objList.forEach((function(teachingObj){learningObjectives.push(teachingObj.learningobjectives)}))}(objList);for(const evaluation of evaluations){const i=evaluations.indexOf(evaluation);0===i?((0,_utils.buildHiddenInput)(evaluation.id,i,"fitem_id_evaluation_title_"+i,"evaluation_"),document.querySelector('[name = "evaluation_0_id_value"]').setAttribute("value",evaluation.id)):(null===document.getElementById("id_evaluation_title_"+i)&&await addEvaluation(!1),editorFields.forEach((editorField=>{document.querySelector("#id_evaluation_"+editorField+"_"+i).value=evaluation[editorField]})),document.querySelector('[name = "evaluation_'+i+'_id_value"]').setAttribute("value",evaluation.id),await handleEditor(i)),fillFormCommonPart(evaluation,i)}(0,_utils.prepareActionButton)([{type:0,id:"evaluation_0"},{type:1,id:"evaluation"}]),disableEvaluationDeleteButton(),styleCheckbox(),(0,_accordionHandler.initAccordionsAfterFillingForm)(),(0,_accordionHandler.handleAccordions)()},_exports.initEvaluations=function(){(0,_evaluationValidator.validateEvaluationForm)(),formatInitialObjList();document.getElementById("form_container").addEventListener("click",(async event=>{if("BUTTON"===event.target.nodeName||"I"===event.target.nodeName&&event.target.parentNode&&"BUTTON"===event.target.parentNode.nodeName){let element=null;if(element="I"===event.target.nodeName?event.target.parentNode:event.target,!element||!element.id.includes("evaluation")||!1!==element.hidden)return;if(element.id.includes("remove")){let id=element.id.substring(element.id.lastIndexOf("_")+1);await async function(index){let evaluation=document.getElementById("row_course_evaluation_container_"+index);for(const editorField of editorFields)await(0,_utils.removeTinyEditor)("id_section_"+editorField+"_"+index);evaluation.remove(),await async function(index){let evaluations=document.querySelectorAll('[id^="row_course_evaluation_container_"]');for(const evaluation of evaluations)if(parseInt(evaluation.id.substring(evaluation.id.lastIndexOf("_")+1))>parseInt(index)){let currentIndex=parseInt(evaluation.id.substring(evaluation.id.lastIndexOf("_")+1));evaluation.setAttribute("id","row_course_evaluation_container_"+(currentIndex-1));let header=evaluation.querySelector(".accordion-header");header.setAttribute("id","course_evaluation_header_"+(currentIndex-1)),header.firstElementChild.setAttribute("href","#collapse_evaluation_"+(currentIndex-1)),header.firstElementChild.setAttribute("aria-controls","collapse_evaluation_"+(currentIndex-1)),header.firstElementChild.innerHTML=await(0,_str.get_string)("evaluation","format_udehauthoring")+" "+currentIndex;let collapsible=evaluation.querySelector(".collapse");collapsible.setAttribute("id","collapse_evaluation_"+(currentIndex-1)),collapsible.firstElementChild.setAttribute("id","course_evaluation_content_"+(currentIndex-1)),collapsible.firstElementChild.children[0].setAttribute("name","evaluation_"+(currentIndex-1)+"_id_value"),updateExistingWeight(evaluation,currentIndex),updateExistingEvaluationObjectives(evaluation,currentIndex),updateExistingModules(evaluation,currentIndex),await(0,_utils.updateEditorAndLabel)(evaluation,currentIndex,"title","evaluation"),await(0,_utils.updateEditorAndLabel)(evaluation,currentIndex,"description","evaluation"),await handleEditor(currentIndex-1)}}(index),await updateAddEvaluationButton(),disableEvaluationDeleteButton(),document.querySelectorAll('[id^="fitem_id_remove_evaluation_"]').forEach((function(button,index){button.setAttribute("id","fitem_id_remove_evaluation_"+index);let buttonElm=button.querySelector('[type="button"]');buttonElm.setAttribute("name","remove_evaluation_"+index),buttonElm.setAttribute("id","id_remove_evaluation_"+index)})),counterEvaluations-=1}(id),document.getElementById("udeh-form").dataset.changed="true",event.stopImmediatePropagation()}}})),document.querySelector("#id_add_evaluation").addEventListener("click",(async event=>{if("BUTTON"===event.target.nodeName||"I"===event.target.nodeName&&event.target.parentNode&&"BUTTON"===event.target.parentNode.nodeName){event.stopImmediatePropagation();let element=null;if(element="I"===event.target.nodeName?event.target.parentNode:event.target,!element||!element.id.includes("evaluation")||!1!==element.hidden)return;await addEvaluation(!0),document.getElementById("udeh-form").dataset.changed="true"}}));let addingButtonsContainer=document.querySelectorAll("[class='col-md-9 form-inline align-items-start felement']");addingButtonsContainer&&addingButtonsContainer.forEach((function(addingButtonContainer){if("button"===addingButtonContainer.dataset.fieldtype){addingButtonContainer.removeAttribute("class"),addingButtonContainer.childNodes.forEach((child=>{child.type&&"button"===child.type&&child.classList.remove("btn-secondary")}))}}));let addingButtons=document.querySelectorAll("[class*='add_action_button']");addingButtons&&addingButtons.forEach((function(addingButton){addingButton.childNodes.forEach((child=>{child.removeAttribute("class")}))}));disableEvaluationDeleteButton(),function(){let rows=document.getElementById("fitem_id_evaluation_learning_objectives_0").querySelectorAll(".form-group");if(void 0!==rows[rows.length-1]){let tooltipContainer=rows[rows.length-1].children[1].firstElementChild.getElementsByTagName("div");if(tooltipContainer[0]){document.getElementById("evaluation_learning_objectives_title_0").appendChild(tooltipContainer[0])}}}(),formatInitialObjList()},_exports.initPhpEvaluationValidation=function(evalName){(0,_evaluationValidator.validateEvaluationDataForm)(),(0,_utils.handleEmbed)("fitem_id_evaluation_introduction_embed","fitem_id_evaluation_introduction"),(0,_toolHelper.initRedactTools)(2,[evalName])};const editorFields=["title","description"];let counterEvaluations=0,learningObjectives=[];async function addEvaluation(fromBtnClick){counterEvaluations+=1;let evaluation=document.querySelector("#row_course_evaluation_container_0").cloneNode(!0);evaluation.setAttribute("id","row_course_evaluation_container_"+counterEvaluations),evaluation.querySelector("#course_evaluation_objectives_header_0").setAttribute("id","course_evaluation_objectives_header_"+counterEvaluations),evaluation.querySelector('[href="#collapse_evaluation_0"]').innerText=await(0,_str.get_string)("evaluation","format_udehauthoring")+" "+(counterEvaluations+1),evaluation.querySelector('[href="#collapse_evaluation_0"]').setAttribute("aria-controls","collapse_evaluation_"+counterEvaluations),evaluation.querySelector('[href="#collapse_evaluation_0"]').setAttribute("href","#collapse_evaluation_"+counterEvaluations),evaluation.querySelector("#collapse_evaluation_0").setAttribute("id","collapse_evaluation_"+counterEvaluations),evaluation.querySelector("#course_evaluation_content_0").setAttribute("id","course_evaluation_content_"+counterEvaluations),evaluation.querySelector('[name="evaluation_0_id_value"]')&&(evaluation.querySelector('[name="evaluation_0_id_value"]').setAttribute("value",""),evaluation.querySelector('[name="evaluation_0_id_value"]').setAttribute("name","evaluation_"+counterEvaluations+"_id_value")),editorFields.forEach((editorField=>{(0,_utils.setEditorAfterCloning)(evaluation,editorField,"evaluation",counterEvaluations,null,fromBtnClick)})),(0,_utils.setDeleteButton)(evaluation,"remove_evaluation",counterEvaluations);let weight=evaluation.querySelector("#fitem_id_evaluation_weight_0");weight.setAttribute("id","fitem_id_evaluation_weight_"+counterEvaluations),weight.querySelector('[for="id_evaluation_weight_0"]').setAttribute("for","id_evaluation_weight_"+counterEvaluations),weight.querySelector("#id_evaluation_weight_0").setAttribute("name","evaluation_weight_"+counterEvaluations),weight.querySelector("#id_evaluation_weight_0").value="",weight.querySelector("#id_evaluation_weight_0").setAttribute("id","id_evaluation_weight_"+counterEvaluations),weight.querySelector("#id_error_evaluation_weight_0").setAttribute("id","id_error_evaluation_weight_"+counterEvaluations),["learning_objectives","module"].forEach((elm=>{let container=evaluation.querySelector("#fitem_id_evaluation_"+elm+"_0");container.setAttribute("name","evaluation_"+elm+"_"+counterEvaluations),container.setAttribute("id","fitem_id_evaluation_"+elm+"_"+counterEvaluations),container.querySelector("#evaluation_"+elm+"_title_0").setAttribute("id","evaluation_"+elm+"_title_"+counterEvaluations),container.querySelector('[for="fitem_id_evaluation_'+elm+'_0"]').setAttribute("for","fitem_id_evaluation_"+elm+"_"+counterEvaluations),container.querySelectorAll(".form-group.row").forEach((objective=>{let hiddenInput=objective.querySelector('input[type="hidden"][name^="evaluation_'+elm+'_0"]');hiddenInput.setAttribute("name",hiddenInput.getAttribute("name").replace("0",counterEvaluations));let input=objective.querySelector('input[type="checkbox"][name^="evaluation_'+elm+'_0"]');input.setAttribute("name",input.getAttribute("name").replace("0",counterEvaluations)),input.setAttribute("id",input.getAttribute("id").replace("0",counterEvaluations)),input.checked=!1;let label=objective.querySelector('[for^="id_evaluation_'+elm+'_0_"]');label.setAttribute("for",label.getAttribute("for").replace("0",counterEvaluations))}))})),document.querySelector("#displayable-form-evaluations-container").insertBefore(evaluation,document.querySelector("#evaluation-add-container")),disableEvaluationDeleteButton(),await updateAddEvaluationButton(),fromBtnClick&&((0,_accordionHandler.handleNewAccordion)("#course_evaluation_objectives_header_",counterEvaluations),await handleEditor(counterEvaluations))}const handleEditor=async counter=>{editorFields.forEach((editorField=>{window.$.ajax({type:"POST",url:"../handlers/ajax_editor_handler.php",data:{id:document.querySelector("#udeh-form").querySelector('[name = "course_id"]').value,elementId:"id_evaluation_"+editorField+"_"+counter,text:""},success:function(response){let draftIdElm=document.querySelector("#row_course_evaluation_container_"+counter).querySelector('[name = "evaluation_'+editorField+"_"+counter+'[itemid]"]');(0,_utils.initEditor)(response,draftIdElm)},error:async function(e){window.console.log(e)}})}))};function formatInitialObjList(){let labels=document.querySelectorAll('[for^="id_evaluation_learning_objectives_0"]');for(let i=0;i<labels.length;i++)labels[i].setAttribute("style","display:flex;")}function disableEvaluationDeleteButton(){if(1===document.querySelectorAll('[id^="row_course_evaluation_container_"]').length){document.getElementById("id_remove_evaluation_0").hidden=!0}else{document.querySelectorAll('[id^="id_remove_evaluation"]').forEach((button=>{button.hidden=!1}))}}async function updateAddEvaluationButton(){let x=document.querySelectorAll('[id^="row_course_evaluation_container_"]');document.getElementById("evaluation-add-container").querySelector(".add-text").innerHTML=await(0,_str.get_string)("evaluation","format_udehauthoring")+" "+(x.length+1)}function updateExistingModules(evaluation,currentIndex){let moduleContainer=evaluation.querySelector('[id^="fitem_id_evaluation_module_"]');moduleContainer.setAttribute("id","fitem_id_evaluation_module_"+(currentIndex-1)),moduleContainer.querySelector('[for^="id_evaluation_module_"]').setAttribute("for","id_evaluation_module_"+(currentIndex-1))}function updateExistingEvaluationObjectives(evaluation,currentIndex){let objContainer=evaluation.querySelector('[id^="fitem_id_evaluation_learning_objectives_"]');objContainer.setAttribute("id","fitem_id_evaluation_learning_objectives_"+(currentIndex-1)),objContainer.children[0].setAttribute("id","evaluation_learning_objectives_title_"+(currentIndex-1)),objContainer.children[0].children[0].setAttribute("for","evaluation_learning_objectives_title_"+(currentIndex-1)),objContainer.querySelectorAll('[class^="form-group row  fitem  "]').forEach((checkbox=>{let innerContainer=checkbox.querySelector('[class^="form-check d-flex"]'),currentObjId=innerContainer.children[0].name.substring(innerContainer.children[0].name.indexOf("[")+1,innerContainer.children[0].name.indexOf("]"));innerContainer.children[0].name="evaluation_learning_objectives_"+(currentIndex-1)+"["+currentObjId+"]",innerContainer.children[1].name="evaluation_learning_objectives_"+(currentIndex-1)+"["+currentObjId+"]",innerContainer.children[1].id="id_evaluation_learning_objectives_"+(currentIndex-1)+"_"+currentObjId,innerContainer.children[2].setAttribute("for","id_evaluation_learning_objectives_"+(currentIndex-1))}))}function updateExistingWeight(evaluation,currentIndex){let weightContainer=evaluation.querySelector('[id^="fitem_id_evaluation_weight_"]');weightContainer.setAttribute("id","fitem_id_evaluation_weight_"+(currentIndex-1)),weightContainer.querySelector('[for^="id_evaluation_weight_"]').setAttribute("for","id_evaluation_weight_"+(currentIndex-1));let input=evaluation.querySelector('[id^="id_evaluation_weight_"]');input.setAttribute("id","id_evaluation_weight_"+(currentIndex-1)),input.setAttribute("name","evaluation_weight_"+(currentIndex-1))}function fillFormCommonPart(evaluation,index){if(document.getElementById("id_evaluation_weight_"+index).value=evaluation.weight,evaluation.learningobjectiveids.forEach((element=>{let learningObjectiveElement=document.getElementById("id_evaluation_learning_objectives_"+index+"_"+element.audehlearningobjectiveid);learningObjectiveElement&&(learningObjectiveElement.checked=!0)})),evaluation.audehsectionids)for(const prop in evaluation.audehsectionids)document.getElementById("id_evaluation_module_"+index+"_"+prop)&&(document.getElementById("id_evaluation_module_"+index+"_"+prop).checked=!0)}const styleCheckbox=()=>{document.querySelectorAll('[class~="checkbox"]').forEach((checkbox=>{checkbox.querySelector("label").classList.add(["pr-5"],["w-100"])}))}}));

//# sourceMappingURL=evaluationHelper.min.js.map