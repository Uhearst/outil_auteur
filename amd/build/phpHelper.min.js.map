{"version":3,"file":"phpHelper.min.js","sources":["../src/phpHelper.js"],"sourcesContent":["import {appendSizeToFileManager, formatEditorAndFileManager, getAndSetScrollPosition, handleEmbed, removeTags} from \"./utils\";\nimport {initRedactTools} from \"./toolHelper\";\nimport {dictionnary} from \"./language/format_udehauthoring_fr\";\nimport {validateSectionForm} from \"./validator/sectionValidator\";\n\nlet counterElement = 0;\nlet counterSubElement = 0;\nlet element = null;\nlet elementName = null;\nlet subElementsName = null;\n\n/**\n * @param {array} params\n */\nexport function init(params) {\n   const decodedParams = JSON.parse(params);\n   setElementNameByType(decodedParams.type);\n   handleInit(decodedParams.courseId,\n       decodedParams.sectionId,\n       decodedParams.subQuestionId,\n       decodedParams.type,\n       decodedParams.toolList);\n   updateAddButtonStyle();\n   updateRemoveButtonStyle(decodedParams.sectionId !== null, decodedParams.subQuestionId !== null);\n   formatEditorAndFileManager();\n   getAndSetScrollPosition();\n   appendSizeToFileManager();\n}\n\n/**\n *\n */\nfunction handleModuleEmbedAndValidation() {\n   validateSectionForm();\n   handleEmbed('fitem_id_section_introduction_embed', 'fitem_id_section_introduction');\n}\n\n/**\n * @param {int} type\n */\nfunction setElementNameByType(type) {\n   if (type === 0) {\n      elementName = dictionnary.module;\n      subElementsName = [dictionnary.trame];\n   } else {\n      elementName = dictionnary.trame;\n      subElementsName = [dictionnary.activity, dictionnary.resource];\n   }\n}\n\n/**\n * @param {int} courseId\n * @param {int} sectionId\n * @param {int} subQuestionId\n * @param {int} type\n * @param {array} toolList\n */\nfunction handleInit(courseId, sectionId, subQuestionId, type, toolList) {\n   if (type === 0) {\n      window.$.ajax(\n          {\n             type: \"POST\",\n             url: \"../handlers/ajax_module_handler.php\",\n             data: {\n                courseId: courseId\n             },\n             success: function(response) {\n                let parsedResponse = JSON.parse(response);\n                parsedResponse.data.forEach(function(module, i) {\n                   if (parseInt(module.id) === sectionId) {\n                      element = module;\n                      counterElement = i;\n                   }\n                });\n                updatePreviewHeader(false);\n                subElementsName.forEach(subElementName => {\n                   updateCurrentAccordions(subElementName);\n                });\n             },\n             error: function() {\n                window.console.log('failure');\n             }\n          });\n      handleModuleEmbedAndValidation();\n   } else {\n      window.$.ajax(\n          {\n             type: \"POST\",\n             url: \"../handlers/ajax_subquestion_handler.php\",\n             data: {\n                sectionId: sectionId,\n                courseId: courseId\n             },\n             success: function(response) {\n                let parsedResponse = JSON.parse(response);\n                parsedResponse.data.forEach(function(subQuestion, i) {\n                   if (parseInt(subQuestion.id) === subQuestionId) {\n                      element = subQuestion;\n                      counterElement = parsedResponse.sectionIndex;\n                      counterSubElement = i;\n                   }\n                });\n                updatePreviewHeader(true);\n                subElementsName.forEach(subElementName => {\n                   updateCurrentAccordions(subElementName);\n                });\n             },\n             error: function() {\n                window.console.log('failure');\n             }\n          });\n      initRedactTools(1, toolList);\n      handleFreeActivity();\n   }\n}\n\n/**\n *\n */\nfunction handleFreeActivity() {\n   let freeTypesTextArea = document.querySelectorAll('[name^=\"exploration_activity_type[\"]');\n   for (let i = 0; i < freeTypesTextArea.length; i++) {\n      hideShowFreeActivity(freeTypesTextArea, i);\n      freeTypesTextArea[i].addEventListener('change', () => {\n         hideShowFreeActivity(freeTypesTextArea, i);\n      });\n   }\n}\n\n/**\n * @param {NodeList} freeTypesTextArea\n * @param {int} i\n */\nfunction hideShowFreeActivity(freeTypesTextArea, i) {\n   let currentContainer = document.getElementById('fitem_id_exploration_activity_free_type_' + i);\n   if (freeTypesTextArea[i].value !== '19') {\n      currentContainer.setAttribute('style', 'display: none !important;');\n   } else {\n      if (currentContainer.getAttribute('style') !== null) {\n         currentContainer.removeAttribute('style');\n      }\n   }\n}\n\n/**\n *\n */\nfunction updateAddButtonStyle() {\n   let addButtons = document.querySelectorAll('[name^=\"add\"]');\n   addButtons.forEach(function(addButton, i) {\n      if (addButton.getAttribute('type') === 'submit') {\n         let colContainers = document.querySelectorAll('.add_action_button');\n         let icon = document.createElement('i');\n\n         let updatedButton = changeTag(addButton, 'button');\n         updatedButton.setAttribute('class', 'btn add-button');\n\n         icon.setAttribute('class', 'fa fa-plus-circle fa-2x');\n         updatedButton.appendChild(icon);\n         colContainers[i].appendChild(updatedButton);\n         addButton.hidden = true;\n      }\n   });\n}\n\n/**\n * @param {object} isSectionPage\n * @param {string} isSubQuestionPage\n */\nfunction updateRemoveButtonStyle(isSectionPage, isSubQuestionPage) {\n   let removeButtons = document.querySelectorAll('[name^=\"remove_\"]');\n   removeButtons.forEach(removeButton=> {\n      if (removeButton.getAttribute('type') === 'submit') {\n         let icon = document.createElement('i');\n\n         let updatedButton = changeTag(removeButton, 'button');\n         updatedButton.setAttribute('class', 'btn remove-button');\n\n         icon.setAttribute('class', 'fa fa-minus-circle fa-2x');\n         updatedButton.appendChild(icon);\n         removeButton.parentElement.appendChild(updatedButton);\n         removeButton.parentElement.classList.add('remove_action_button');\n         removeButton.hidden = true;\n      }\n   });\n   if (isSectionPage && !isSubQuestionPage) {\n      disableRemoveButton([...removeButtons], 'id_remove_section');\n   } else if (isSubQuestionPage) {\n      disableRemoveButton([...removeButtons]\n          .filter(removeButton => removeButton.id.includes('exploration')), 'id_remove_exploration');\n      disableRemoveButton([...removeButtons].filter(removeButton => removeButton.id.includes('resource')), 'id_remove_resource');\n   }\n\n}\n\n/**\n * @param {Array} buttonList\n * @param {string} id\n */\nfunction disableRemoveButton(buttonList, id) {\n   if (buttonList.length === 1) {\n      let buttons = document.querySelectorAll('[id^=\"' + id + '\"]');\n      buttons.forEach(button => {\n         if (button.tagName === 'BUTTON') {\n            button.hidden = true;\n         }\n      });\n   } else {\n      let buttons = document.querySelectorAll('[id^=\"' + id + '\"]');\n      buttons.forEach(button => {\n         if (button.tagName === 'BUTTON') {\n            button.hidden = false;\n         }\n      });\n   }\n}\n\n\n/**\n * @param {object} element\n * @param {string} tag\n */\nfunction changeTag(element, tag) {\n   const newElem = document.createElement(tag);\n   const clone = element.cloneNode(true);\n\n   while (clone.firstChild) {\n      newElem.appendChild(clone.firstChild);\n   }\n\n   if(clone.attributes) {\n      for(let i = 0; i < clone.attributes.length; i++) {\n         newElem.setAttribute(clone.attributes[i].name, clone.attributes[i].value);\n      }\n   }\n\n   return newElem;\n}\n\n/**\n * @param {boolean} isSubquestion\n */\nfunction updatePreviewHeader(isSubquestion) {\n   let headerPreview = document.querySelector('[id*=\"preview_header\"]');\n   if (isSubquestion) {\n      headerPreview.firstElementChild.innerHTML = elementName + (counterElement + 1) + '.'\n          + (counterSubElement + 1) + ' - ' + removeTags(element.title);\n   } else {\n      headerPreview.firstElementChild.innerHTML = elementName + (counterElement + 1) + ' - ' + removeTags(element.title);\n   }\n\n}\n\n/**\n * @param {string} subElementName\n */\nfunction updateCurrentAccordions(subElementName) {\n   let accordions = null;\n   let valueForAccordion = null;\n   let valueForDiv = null;\n   if (subElementName === dictionnary.trame) {\n      accordions = document.querySelectorAll('[class*=\"row_section_subquestion_container\"]');\n      valueForAccordion = 'SectionSubQuestion_';\n      valueForDiv = 'subquestion';\n   } else if (subElementName === dictionnary.resource) {\n      accordions = document.querySelectorAll('[class*=\"row_subquestion_resource_container\"]');\n      valueForAccordion = 'SubQuestionResource_';\n      valueForDiv = 'resource';\n   } else if (subElementName === dictionnary.activity) {\n      accordions = document.querySelectorAll('[class*=\"row_subquestion_exploration_container\"]');\n      valueForAccordion = 'SubQuestionExploration_';\n      valueForDiv = 'exploration';\n   }\n   accordions.forEach(function(accordion, i) {\n      let accordionContainer = accordion.querySelector('[class*=\"accordion-container\"]');\n      let headerLink = accordionContainer.firstElementChild.firstElementChild;\n      headerLink.href = '#collapse' + valueForAccordion + (i);\n      headerLink.setAttribute('aria-controls', 'collapse' + valueForAccordion + (i));\n      accordionContainer.children[1].setAttribute('id', 'collapse' + valueForAccordion + (i));\n      if (i > 0) {\n         accordionContainer.children[1].setAttribute('class', 'collapse');\n         headerLink.setAttribute('aria-expanded', 'false');\n         headerLink.setAttribute('class', 'collapsed');\n      }\n      if (subElementName === dictionnary.trame) {\n         updateAccordionText(headerLink, subElementName, i, element.subquestions);\n      } else if (subElementName === dictionnary.resource) {\n         updateAccordionText(headerLink, subElementName, i, element.resources);\n      } else if (subElementName === dictionnary.activity) {\n         updateAccordionText(headerLink, subElementName, i, element.explorations, false);\n      }\n   });\n   let addContainer = document.getElementById('add_' + valueForDiv + '_container');\n   if (subElementName === dictionnary.trame) {\n      addContainer.firstElementChild.firstElementChild.innerHTML =\n          subElementName + ' ' + (counterElement + 1) + '.' + (accordions.length + 1);\n   } else {\n      addContainer.firstElementChild.firstElementChild.innerHTML =\n          subElementName + ' ' + (counterElement + 1) + '.' + (counterSubElement + 1) + '.' + (accordions.length + 1);\n   }\n}\n\n/**\n * @param {object} headerLink\n * @param {string} subElementName\n * @param {int} counter\n * @param {array} array\n * @param {boolean} hasTitle\n */\nfunction updateAccordionText(headerLink, subElementName, counter, array, hasTitle = true) {\n   if (array && array[counter]) {\n      let title = array[counter].title;\n      let headerContent = '';\n      if (hasTitle) {\n         headerContent = subElementName === dictionnary.trame\n             ? subElementName + (counterElement + 1) + '.' + (counter + 1) + ' - ' + removeTags(title)\n             // eslint-disable-next-line max-len\n             : subElementName + (counterElement + 1) + '.' + (counterSubElement + 1) + '.' + (counter + 1) + ' - ' + removeTags(title);\n      } else {\n         headerContent = subElementName === dictionnary.trame\n             ? subElementName + (counterElement + 1) + '.' + (counter + 1)\n             : subElementName + (counterElement + 1) + '.' + (counterSubElement + 1) + '.' + (counter + 1);\n      }\n      headerLink.innerHTML = headerContent.length > 70 ? headerContent.substring(0, 70) + '...' : headerContent;\n   } else {\n      headerLink.innerHTML = subElementName === dictionnary.trame\n      ? subElementName + (counterElement + 1) + '.' + (counter + 1)\n      : subElementName + (counterElement + 1) + '.' + (counterSubElement + 1) + '.' + (counter + 1);\n   }\n}\n\n"],"names":["params","decodedParams","JSON","parse","type","elementName","dictionnary","module","subElementsName","trame","activity","resource","courseId","sectionId","subQuestionId","toolList","window","$","ajax","url","data","success","response","forEach","i","parseInt","id","element","counterElement","updatePreviewHeader","subElementName","updateCurrentAccordions","error","console","log","parsedResponse","subQuestion","sectionIndex","counterSubElement","freeTypesTextArea","document","querySelectorAll","hideShowFreeActivity","addEventListener","length","handleFreeActivity","handleInit","addButton","getAttribute","colContainers","icon","createElement","updatedButton","changeTag","setAttribute","appendChild","hidden","isSectionPage","isSubQuestionPage","removeButtons","removeButton","parentElement","classList","add","disableRemoveButton","_toConsumableArray","filter","includes","currentContainer","getElementById","value","removeAttribute","buttonList","button","tagName","tag","newElem","clone","cloneNode","firstChild","attributes","name","isSubquestion","headerPreview","querySelector","firstElementChild","innerHTML","title","accordions","valueForAccordion","valueForDiv","accordion","accordionContainer","headerLink","href","children","updateAccordionText","subquestions","resources","explorations","addContainer","counter","array","hasTitle","headerContent","substring"],"mappings":"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"}