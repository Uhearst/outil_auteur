define("format_udehauthoring/utils",["exports","core/str","core/config"],(function(_exports,_str,Config){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}let tinyMCEPromise;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.appendAnchorToForm=function(anchor){let anchorInput=document.getElementById("anchor");if(null===anchorInput){var input=document.createElement("input");input.setAttribute("type","hidden"),input.setAttribute("name","anchor"),input.setAttribute("id","anchor"),input.setAttribute("value",anchor);document.getElementById("form_container").appendChild(input)}else anchorInput.setAttribute("value",anchor)},_exports.appendSizeToFileManager=function(){let fileManagers=document.querySelectorAll('[id*="vignette"]');fileManagers&&fileManagers.forEach((fileManager=>{if(fileManager.classList.contains("form-group")){let valueForFormat="";valueForFormat=fileManager.getAttribute("id").includes("resource")?"125 x 80":"364 x 215";let restrictions=fileManager.querySelector(".fp-restrictions");(0,_str.get_string)("evaluationrecommendedformat","format_udehauthoring").then((valueString=>{restrictions.firstElementChild.innerHTML=restrictions.firstElementChild.innerHTML+", "+valueString+valueForFormat})).catch((()=>{restrictions.firstElementChild.innerHTML=restrictions.firstElementChild.innerHTML+", Format recommand√©: "+valueForFormat}))}}))},_exports.appendStyleToAnchorMenuSection=function(id){let container=document.getElementById("collapse-course-container");for(let i=0;i<container.children.length;i++)container.children[i].getAttribute("class").includes("disabled-menu-element")||(container.children[i].setAttribute("class","mb-3"),updateIcon(container.children[i],"actif","passif"));let element=document.getElementById(id);element.classList.add("active-menu-element"),updateIcon(element,"passif","actif",!0)},_exports.buildHiddenInput=function(id,counter,elementName,prefix){let element=document.getElementById(elementName),parent=element.parentNode;if(0===parent.querySelectorAll('[name="'+prefix+counter+'_id_value"]').length){let input=document.createElement("input");input.setAttribute("name",prefix+counter+"_id_value"),input.setAttribute("value",id),input.hidden=!0,parent.insertBefore(input,element)}},_exports.formatEditorAndFileManager=function(){document.getElementById("udeh-form").querySelectorAll('[class^="form-group row  fitem   "]').forEach((input=>{if(input.children[1]&&input.children[1].dataset&&("editor"===input.children[1].dataset.fieldtype||"filemanager"===input.children[1].dataset.fieldtype)){removeUselessColClasses(input.children[0]),removeUselessColClasses(input.children[1]),input.classList.add("mx-2");let label=input.querySelector("label");label&&label.classList.replace("m-0","m-1")}}))},_exports.handleEmbed=function(embedContainerId,introductionContainerId){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,customCheckbox=null,embedValContainer=null;null!==i?(customCheckbox=document.getElementById("embed_selector_"+i),embedValContainer=document.querySelector('[name="isembed['+i+']"]')):(customCheckbox=document.getElementById("embed_selector"),embedValContainer=document.querySelector('[name="isembed"]'));"1"===embedValContainer.value&&(customCheckbox.checked=!0);setEmbedVisible(customCheckbox,embedContainerId,introductionContainerId),customCheckbox.addEventListener("click",(function(){setEmbedVisible(customCheckbox,embedContainerId,introductionContainerId)}))},_exports.initEditor=void 0,_exports.prepareActionButton=function(buttons){let addingButtonsContainer=document.querySelectorAll("[class='col-md-9 form-inline align-items-start felement']");addingButtonsContainer&&addingButtonsContainer.forEach((function(addingButtonContainer){if("button"===addingButtonContainer.dataset.fieldtype){addingButtonContainer.removeAttribute("class"),addingButtonContainer.childNodes.forEach((child=>{child.type&&"button"===child.type&&child.classList.remove("btn-secondary")}))}}));let addingButtons=document.querySelectorAll("[class*='add_action_button']");addingButtons&&addingButtons.forEach((function(addingButton){addingButton.childNodes.forEach((child=>{child.removeAttribute("class")}))}));buttons.forEach((button=>{if(0===button.type){let initialRemoveButton=document.getElementById("fitem_id_remove_"+button.id);initialRemoveButton&&initialRemoveButton.firstElementChild.style.setProperty("display","none","important")}else{let initialRemoveButton=document.getElementById("fitem_id_add_"+button.id);initialRemoveButton&&initialRemoveButton.firstElementChild.style.setProperty("display","none","important")}}))},_exports.removeTags=function(str){if(null===str||""===str)return!1;str=str.toString();return(str=str.replace(/<div class="h5p-placeholder"[^>]*>([\s\S]*?)<\/div>/,"")).replace(/(<([^>]+)>)/gi,"")},_exports.removeTinyEditor=removeTinyEditor,_exports.updateEditorAndLabel=_exports.setEditorAfterCloning=_exports.setDeleteButton=void 0,Config=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Config);async function removeTinyEditor(id){(await getTinyMCE()).get().filter((editor=>editor.id===id)).forEach((editor=>{editor.remove()}))}_exports.initEditor=(response,draftIdElm)=>{let parsedResponse=JSON.parse(response);draftIdElm.setAttribute("value",JSON.parse(parsedResponse.data.config).draftitemid),document.querySelector("footer").querySelectorAll(".footer-section").forEach((footer=>{if(0!==footer.querySelectorAll("script").length){let inlineDefaultConfiguration=document.createElement("script");inlineDefaultConfiguration.text="M.util.js_pending('editor_tiny/editor:defaultConfiguration'); require(['editor_tiny/editor'], (Tiny) => { Tiny.configureDefaultEditor("+parsedResponse.data.editorDefaultConfig+"); M.util.js_complete('editor_tiny/editor:defaultConfiguration'); });",footer.appendChild(inlineDefaultConfiguration);let inlineScript=document.createElement("script");inlineScript.text="M.util.js_pending('editor_tiny/editor'); require(['editor_tiny/editor'], (Tiny) => { Tiny.setupForElementId({ elementId: \""+parsedResponse.data.elementId+'", options: '+parsedResponse.data.config+"}); M.util.js_complete('editor_tiny/editor');});",footer.appendChild(inlineScript)}}))};const getTinyMCE=()=>{const baseUrl="".concat(Config.wwwroot,"/lib/editor/tiny/loader.php/").concat(M.cfg.jsrev);return tinyMCEPromise||(tinyMCEPromise=new Promise(((resolve,reject)=>{const head=document.querySelector("head");let script=head.querySelector('script[data-tinymce="tinymce"]');script&&resolve(window.tinyMCE),script=document.createElement("script"),script.dataset.tinymce="tinymce",script.src="".concat(baseUrl,"/tinymce.js"),script.async=!0,script.addEventListener("load",(()=>{resolve(window.tinyMCE)}),!1),script.addEventListener("error",(err=>{reject(err)}),!1),head.append(script)})),tinyMCEPromise)};const removeUselessColClasses=node=>{Array.from(node.classList).forEach((className=>{className.startsWith("col-")&&!className.startsWith("col-form")&&node.classList.remove(className)})),node.classList.add("col-12")};function updateIcon(element,previousValue,newValue){let isActive=arguments.length>3&&void 0!==arguments[3]&&arguments[3],src=element.firstElementChild.firstElementChild.getAttribute("src");if(src&&src.includes(previousValue)){let newSrc=src.replace(previousValue,newValue);element.firstElementChild.firstElementChild.setAttribute("src",newSrc),element.setAttribute("onmouseout",'this.firstElementChild.firstElementChild.setAttribute("src", "'+newSrc+'")')}isActive?element.firstElementChild.setAttribute("class","active router"):element.firstElementChild.setAttribute("class","router")}function setEmbedVisible(customCheckbox,embedContainerId,introductionContainerId){let embedContainer=document.getElementById(embedContainerId),introductionContainer=document.getElementById(introductionContainerId);customCheckbox.checked?(embedContainer.style="",introductionContainer.style="display:none !important"):(embedContainer.style="display:none !important",introductionContainer.style="")}_exports.setEditorAfterCloning=function(editorContainer,field,prefix,counter){let parentUpdatedField=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,fromBtnClick=arguments.length>5&&void 0!==arguments[5]&&arguments[5];editorContainer.querySelector("#fitem_id_"+prefix+"_"+field+"_0").setAttribute("id",parentUpdatedField?"fitem_id_"+prefix+"_"+parentUpdatedField+"_"+counter:"fitem_id_"+prefix+"_"+field+"_"+counter),editorContainer.querySelector('[for="id_'+prefix+"_"+field+'_0"]')&&editorContainer.querySelector('[for="id_'+prefix+"_"+field+'_0"]').setAttribute("for","id_"+prefix+"_"+field+"_"+counter);let textEvalParentNode=editorContainer.querySelector("#id_"+prefix+"_"+field+"_0").parentNode;(fromBtnClick||textEvalParentNode&&null!==textEvalParentNode.querySelector('[role="application"]'))&&(null!==textEvalParentNode.querySelector('[role="application"]')&&textEvalParentNode.querySelector('[role="application"]').remove(),null!==textEvalParentNode.querySelector(".tox-tinymce-aux")&&textEvalParentNode.querySelector(".tox-tinymce-aux").remove()),editorContainer.querySelector("#id_"+prefix+"_"+field+"_0").setAttribute("style",""),editorContainer.querySelector("#id_"+prefix+"_"+field+"_0").value="",editorContainer.querySelector("#id_"+prefix+"_"+field+"_0").setAttribute("name",parentUpdatedField?prefix+"_"+parentUpdatedField+"_"+counter+"[text]":prefix+"_"+field+"_"+counter+"[text]"),editorContainer.querySelector("#id_"+prefix+"_"+field+"_0").setAttribute("id",parentUpdatedField?"id_"+prefix+"_"+parentUpdatedField+"_"+counter:"id_"+prefix+"_"+field+"_"+counter),editorContainer.querySelector("#menu"+prefix+"_"+field+"_0format").setAttribute("name",parentUpdatedField?prefix+"_"+parentUpdatedField+"_"+counter+"[format]":prefix+"_"+field+"_"+counter+"[format]"),editorContainer.querySelector("#menu"+prefix+"_"+field+"_0format").setAttribute("id",parentUpdatedField?"menu"+prefix+"_"+field+"_"+counter+"format":"menu"+prefix+"_"+parentUpdatedField+"_"+counter+"format"),editorContainer.querySelector('[name="'+prefix+"_"+field+'_0[itemid]"').setAttribute("value",""),editorContainer.querySelector('[name="'+prefix+"_"+field+'_0[itemid]"').setAttribute("name",parentUpdatedField?prefix+"_"+parentUpdatedField+"_"+counter+"[itemid]":prefix+"_"+field+"_"+counter+"[itemid]"),editorContainer.querySelector("#id_error_"+prefix+"_"+field+"_0").setAttribute("id",parentUpdatedField?"id_error_"+prefix+"_"+parentUpdatedField+"_"+counter:"id_error_"+prefix+"_"+field+"_"+counter)};_exports.setDeleteButton=function(container,elm,counter){let subCounter=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",baseSubCounter=""===subCounter?"":"_0";container.querySelector("#fitem_id_"+elm+"_0"+baseSubCounter).setAttribute("id","fitem_id_"+elm+"_"+counter+subCounter),container.querySelector('[name="'+elm+"_0"+baseSubCounter+'"]').setAttribute("id","id_"+elm+"_"+counter+subCounter),container.querySelector('[name="'+elm+"_0"+baseSubCounter+'"]').setAttribute("name",elm+"_"+counter+subCounter),container.querySelector("#id_error_"+elm+"_0"+baseSubCounter).setAttribute("id","id_error_"+elm+"_"+counter+subCounter)};_exports.updateEditorAndLabel=async(elm,currentIndex,element,prefix)=>{let container=elm.querySelector('[id^="fitem_id_'+prefix+"_"+element+'_"]');container.setAttribute("id","fitem_id_"+prefix+"_"+element+"_"+(currentIndex-1));let containerLabel=container.querySelector('[for^="id_'+prefix+"_"+element+'_"]');containerLabel&&containerLabel.setAttribute("for","id_"+prefix+"_"+element+"_"+(currentIndex-1)),await removeTinyEditor("id_"+prefix+"_"+element+"_"+currentIndex);let editorTextArea=container.querySelector('[id^="id_'+prefix+"_"+element+'_"]');editorTextArea.setAttribute("id","id_"+prefix+"_"+element+"_"+(currentIndex-1)),editorTextArea.setAttribute("name",prefix+"_"+element+"_"+(currentIndex-1)+"[text]");let editorFormat=container.querySelector('[name="'+prefix+"_"+element+"_"+currentIndex+'[format]"]');editorFormat.setAttribute("id","menu"+prefix+"_"+element+"_"+(currentIndex-1)+"format"),editorFormat.setAttribute("name",prefix+"_"+element+"_"+(currentIndex-1)+"[format]"),container.querySelector('[name="'+prefix+"_"+element+"_"+currentIndex+'[itemid]"]').setAttribute("name",prefix+"_"+element+"_"+(currentIndex-1)+"[itemid]"),container.querySelector("#id_error_"+prefix+"_"+element+"_"+currentIndex).setAttribute("id","id_error_"+prefix+"_"+element+"_"+(currentIndex-1))}}));

//# sourceMappingURL=utils.min.js.map