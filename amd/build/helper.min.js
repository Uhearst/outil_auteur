define("format_udehauthoring/helper",["exports","./moduleHelper","./objectiveHelper","./additionalHelper","./utils","./evaluationHelper","./courseHelper","./notificationHelper","core/str"],(function(_exports,_moduleHelper,_objectiveHelper,_additionalHelper,_utils,_evaluationHelper,_courseHelper,_notificationHelper,_str){function handleInit(){let n=window.location.pathname.lastIndexOf("/"),page=window.location.pathname.substring(n+1),anchor=window.location.href.includes("#")?window.location.href.substring(window.location.href.lastIndexOf("#")+1):"displayable-form-informations-container";page.includes("course")&&((0,_utils.appendAnchorToForm)(anchor),"displayable-form-objectives-container"===anchor?((0,_objectiveHelper.initObjectives)(),(0,_utils.appendStyleToAnchorMenuSection)("item-teachingobjectives")):"displayable-form-sections-container"===anchor?((0,_moduleHelper.initModules)(),(0,_utils.appendStyleToAnchorMenuSection)("item-coursesections")):"displayable-form-evaluations-container"===anchor?((0,_evaluationHelper.initEvaluations)(),(0,_utils.appendStyleToAnchorMenuSection)("item-learningevaluations")):"displayable-form-additional-information-container"===anchor?((0,_additionalHelper.initAdditional)(),(0,_utils.appendStyleToAnchorMenuSection)("item-additionalinformation")):((0,_courseHelper.initCourse)(),(0,_utils.appendStyleToAnchorMenuSection)("item-generalinformations"))),window.$(document).scrollTop(0),(0,_utils.formatEditorAndFileManager)()}function handleFillForms(params){let n=window.location.pathname.lastIndexOf("/"),page=window.location.pathname.substring(n+1),anchor=window.location.href.includes("#")?window.location.href.substring(window.location.href.lastIndexOf("#")+1):"displayable-form-informations-container";if(page.includes("course")){let parsedResponse=null;const decodedParams=JSON.parse(params);window.$.ajax({type:"POST",url:"../handlers/ajax_course_handler.php",data:{courseId:decodedParams.courseId},success:async function(response){parsedResponse=JSON.parse(response),"displayable-form-objectives-container"===anchor?await(0,_objectiveHelper.fillFormObjectives)(parsedResponse.data.teachingobjectives):"displayable-form-sections-container"===anchor?await(0,_moduleHelper.fillFormModules)(parsedResponse.data.sections):"displayable-form-evaluations-container"===anchor?await(0,_evaluationHelper.fillFormEvaluations)(parsedResponse.data.evaluations,parsedResponse.data.sections):"displayable-form-additional-information-container"===anchor&&await(0,_additionalHelper.fillFormAdditional)(parsedResponse.data.additionalinformation),(0,_utils.formatEditorAndFileManager)()},error:function(){window.console.log("failure")}})}}function saveWarningModal(href){let courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,form=document.getElementById("udeh-form");if("true"===form.dataset.changed){let modalContainer=window.$("#save-warning-container");modalContainer.show();let modal=window.$(".save-warning"),modalButton=document.querySelector(".save-warning").querySelector(".btn-secondary");(0,_str.get_string)(0!==courseId?"publishwarning":"savewarning","format_udehauthoring").then((valueString=>{document.querySelector(".save-warning").querySelector("p").innerHTML=valueString})).catch((()=>{document.querySelector(".save-warning").querySelector("p").innerHTML="ÃŠtes-vous certain(e) de vouloir publier sans sauvegarder?"}));let key="",component="";0!==courseId?(key="publish",component="format_udehauthoring"):(key="continue",component="theme_remui"),(0,_str.get_string)(key,component).then((valueString=>{modalButton.innerHTML=valueString})).catch((()=>{modalButton.innerHTML("Publier")})),modal.show(),modalButton.addEventListener("click",(()=>{modalContainer.hide(),modal.hide(),href?(form.dataset.changed="false",window.location.href=href):courseId&&publishCourse(courseId)})),document.querySelector(".save-warning").querySelector(".btn-primary").addEventListener("click",(()=>{modalContainer.hide(),modal.hide()}))}else href?window.location.href=href:courseId&&publishCourse(courseId)}function publishCourse(courseId){window.$("#save-warning-container").show(),window.$("#progress-circle").show();const queryString=window.location.search,urlParams=new URLSearchParams(queryString);window.$.ajax({type:"POST",url:"../handlers/ajax_export_handler.php",data:{courseId:courseId,id:urlParams.get("id")},success:async function(response){let parsedResponse=JSON.parse(response);if(parsedResponse.error)(0,_notificationHelper.addNotification)(await(0,_str.get_string)("notificationerrorpublishcourse","format_udehauthoring")+" "+parsedResponse.msg,2);else{let previewButton=document.querySelector("#preview-button");parsedResponse.data.hasOwnProperty("previewurls")?previewButton.setAttribute("data-urls",JSON.stringify(parsedResponse.data.previewurls)):previewButton.setAttribute("data-url",parsedResponse.data.previewurl),(0,_notificationHelper.addNotification)(await(0,_str.get_string)("notificationpublishcourse","format_udehauthoring"),1)}window.$("#save-warning-container").hide(),window.$("#progress-circle").hide()},error:async function(){window.$("#save-warning-container").hide(),window.$("#progress-circle").hide(),(0,_notificationHelper.addNotification)(await(0,_str.get_string)("notificationerrorpublishcourse","format_udehauthoring"),2)}})}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.exportCourse=function(courseId){document.getElementById("publishCourse").addEventListener("click",(function(evt){evt.preventDefault(),saveWarningModal(null,courseId)}))},_exports.fillForm=function(array){handleFillForms(array),window.addEventListener("hashchange",(function(){handleFillForms(array)}))},_exports.init=function(){handleInit(),window.addEventListener("hashchange",(function(){handleInit()}))},_exports.initSaveWarningModal=function(){document.querySelectorAll(".router").forEach((link=>{link.addEventListener("click",(e=>{e.preventDefault(),"A"===e.target.nodeName?(e.preventDefault(),saveWarningModal(e.target.href)):""!==e.target.closest("a")?(e.preventDefault(),saveWarningModal(e.target.closest("a").href)):""!==e.target.first("a")&&(e.preventDefault(),saveWarningModal(e.target.first("a").href))}))}))},_exports.publishCoursePlan=function(Ids){document.getElementById("publishCoursePlan").addEventListener("click",(function(){window.open("../handlers/pdf_syllabus_handler.php?courseId="+Ids[1])}))},_exports.saveWarningModal=saveWarningModal}));

//# sourceMappingURL=helper.min.js.map